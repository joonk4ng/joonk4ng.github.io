import{r as h,a as lt,R as fe}from"./vendor-57209f9c.js";import{P as Oe,G as Ne,g as ut}from"./pdf-1f73188d.js";import{r as _e,u as Pe,w as dt}from"./xlsx-4f9172c7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();var Le={exports:{}},he={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ft=h,mt=Symbol.for("react.element"),ht=Symbol.for("react.fragment"),gt=Object.prototype.hasOwnProperty,wt=ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yt={key:!0,ref:!0,__self:!0,__source:!0};function Ie(e,t,s){var o,r={},l=null,u=null;s!==void 0&&(l=""+s),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(u=t.ref);for(o in t)gt.call(t,o)&&!yt.hasOwnProperty(o)&&(r[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps,t)r[o]===void 0&&(r[o]=t[o]);return{$$typeof:mt,type:e,key:l,ref:u,props:r,_owner:wt.current}}he.Fragment=ht;he.jsx=Ie;he.jsxs=Ie;Le.exports=he;var a=Le.exports,xe={},Re=lt;xe.createRoot=Re.createRoot,xe.hydrateRoot=Re.hydrateRoot;const Z=[{name:"John Smith",classification:"FFT1",days:[{date:"2024-06-01",on:"0830",off:"1730"},{date:"2024-06-02",on:"0830",off:"1730"}]},{name:"Jane Doe",classification:"FFT2",days:[{date:"2024-06-01",on:"0830",off:"1730"},{date:"2024-06-02",on:"0830",off:"1730"}]}];function Nt(e,t,s){var r,l;const o={};return t&&(o["1 CREW NAME"]=t.crewName||"",o["2 CREW NUMER"]=t.crewNumber||"",o["4FIRE NAME"]=t.fireName||"",o["5 FIRE NUMBER"]=t.fireNumber||""),(r=e[0])!=null&&r.days[0]&&(o.DATE=e[0].days[0].date),(l=e[0])!=null&&l.days[1]&&(o.DATE_2=e[0].days[1].date),e.forEach((u,D)=>{var p,f;if(!(u!=null&&u.name)&&!(u!=null&&u.classification))return;const i=D+1;o[`NAME OF EMPLOYEERow${i}`]=u.name||"",o[`ClASS IF CATIONRow${i}`]=u.classification||"",(p=u.days)!=null&&p[0]&&(o[`ONRow${i}`]=u.days[0].on||"",o[`OFFRow${i}`]=u.days[0].off||""),(f=u.days)!=null&&f[1]&&(o[`ONRow${i}_2`]=u.days[1].on||"",o[`OFFRow${i}_2`]=u.days[1].off||"")}),o}function Se(e){const{date:t,crewNumber:s,fireName:o,fireNumber:r,type:l}=e,u=t.includes("-")?t:new Date(t).toISOString().split("T")[0],D=s.replace(/[^a-zA-Z0-9]/g,""),i=o.replace(/[^a-zA-Z0-9]/g,""),p=r.replace(/[^a-zA-Z0-9]/g,""),f=`${u} ${D} ${i} ${p} ${l} CTR`;switch(l){case"PDF":return`${f}.pdf`;case"Excel":return`${f}.xlsx`;case"CSV":return`${f}.csv`;default:return f}}const bt=(e,t)=>t.some(s=>e instanceof s);let Te,Me;function Dt(){return Te||(Te=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pt(){return Me||(Me=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const We=new WeakMap,Ee=new WeakMap,He=new WeakMap,be=new WeakMap,je=new WeakMap;function vt(e){const t=new Promise((s,o)=>{const r=()=>{e.removeEventListener("success",l),e.removeEventListener("error",u)},l=()=>{s(K(e.result)),r()},u=()=>{o(e.error),r()};e.addEventListener("success",l),e.addEventListener("error",u)});return t.then(s=>{s instanceof IDBCursor&&We.set(s,e)}).catch(()=>{}),je.set(t,e),t}function xt(e){if(Ee.has(e))return;const t=new Promise((s,o)=>{const r=()=>{e.removeEventListener("complete",l),e.removeEventListener("error",u),e.removeEventListener("abort",u)},l=()=>{s(),r()},u=()=>{o(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",l),e.addEventListener("error",u),e.addEventListener("abort",u)});Ee.set(e,t)}let Ce={get(e,t,s){if(e instanceof IDBTransaction){if(t==="done")return Ee.get(e);if(t==="objectStoreNames")return e.objectStoreNames||He.get(e);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return K(e[t])},set(e,t,s){return e[t]=s,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function St(e){Ce=e(Ce)}function Et(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const o=e.call(De(this),t,...s);return He.set(o,t.sort?t.sort():[t]),K(o)}:pt().includes(e)?function(...t){return e.apply(De(this),t),K(We.get(this))}:function(...t){return K(e.apply(De(this),t))}}function Ct(e){return typeof e=="function"?Et(e):(e instanceof IDBTransaction&&xt(e),bt(e,Dt())?new Proxy(e,Ce):e)}function K(e){if(e instanceof IDBRequest)return vt(e);if(be.has(e))return be.get(e);const t=Ct(e);return t!==e&&(be.set(e,t),je.set(t,e)),t}const De=e=>je.get(e);function Ue(e,t,{blocked:s,upgrade:o,blocking:r,terminated:l}={}){const u=indexedDB.open(e,t),D=K(u);return o&&u.addEventListener("upgradeneeded",i=>{o(K(u.result),i.oldVersion,i.newVersion,K(u.transaction),i)}),s&&u.addEventListener("blocked",i=>s(i.oldVersion,i.newVersion,i)),D.then(i=>{l&&i.addEventListener("close",()=>l()),r&&i.addEventListener("versionchange",p=>r(p.oldVersion,p.newVersion,p))}).catch(()=>{}),D}const jt=["get","getKey","getAll","getAllKeys","count"],Ft=["put","add","delete","clear"],pe=new Map;function $e(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(pe.get(t))return pe.get(t);const s=t.replace(/FromIndex$/,""),o=t!==s,r=Ft.includes(s);if(!(s in(o?IDBIndex:IDBObjectStore).prototype)||!(r||jt.includes(s)))return;const l=async function(u,...D){const i=this.transaction(u,r?"readwrite":"readonly");let p=i.store;return o&&(p=p.index(D.shift())),(await Promise.all([p[s](...D),r&&i.done]))[0]};return pe.set(t,l),l}St(e=>({...e,get:(t,s,o)=>$e(t,s)||e.get(t,s,o),has:(t,s)=>!!$e(t,s)||e.has(t,s)}));const Pt="ctr-pdf-storage",me="pdfs",Rt=1;async function Ve(){return console.log("Initializing IndexedDB..."),Ue(Pt,Rt,{upgrade(e){console.log("Upgrading database..."),e.objectStoreNames.contains(me)||(console.log("Creating object store..."),e.createObjectStore(me,{keyPath:"id"}))}})}async function Ye(e,t){console.log("Storing PDF in IndexedDB...",t);const s=await Ve(),o=`${t.date}_${t.crewNumber}_${t.fireName}_${t.fireNumber}`;try{return await s.put(me,{id:o,pdf:e,metadata:t,timestamp:new Date().toISOString()}),console.log("PDF stored successfully with ID:",o),o}catch(r){throw console.error("Error storing PDF:",r),r}}async function Tt(e){console.log("Retrieving PDF from IndexedDB:",e);const s=await(await Ve()).get(me,e);return console.log("Retrieved PDF:",s?"Found":"Not found"),s}async function Mt(e,t,s={downloadImmediately:!0},o="/CTR_Fillable_Edited.pdf"){var r,l,u,D;try{const i="./",f=`${o.startsWith("http")?o:`${i}${o.startsWith("/")?o.slice(1):o}`}?t=${Date.now()}`,v=await fetch(f,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!v.ok)throw console.error("PDF fetch failed:",v.status,v.statusText),new Error(`Failed to fetch PDF: ${v.statusText}`);const L=await v.arrayBuffer(),$=await Oe.load(L),g=$.getForm(),j=Nt(e,t);console.log("Available PDF form fields:",g.getFields().map(B=>B.getName())),Object.entries(j).forEach(([B,_])=>{try{console.log(`Attempting to fill field: ${B} with value: ${_}`),g.getTextField(B).setText(_)}catch(Y){console.warn(`Field ${B} not found in PDF:`,Y)}});const R=await $.save(),T=new Blob([R],{type:"application/pdf"}),M=Se({date:((l=(r=e[0])==null?void 0:r.days[0])==null?void 0:l.date)||new Date().toISOString().split("T")[0],crewNumber:t.crewNumber||"",fireName:t.fireName||"",fireNumber:t.fireNumber||"",type:"PDF"}),E=await Ye(T,{filename:M,date:((D=(u=e[0])==null?void 0:u.days[0])==null?void 0:D.date)||new Date().toISOString().split("T")[0],crewNumber:t.crewNumber||"",fireName:t.fireName||"",fireNumber:t.fireNumber||""});if(s.downloadImmediately){const B=URL.createObjectURL(T),_=document.createElement("a");_.href=B,_.download=M,_.click(),URL.revokeObjectURL(B)}return s.returnBlob?{blob:T,filename:M,pdfId:E}:{filename:M,pdfId:E}}catch(i){throw console.error("Error filling PDF:",i),i instanceof Error?i:new Error("Failed to generate PDF. Please check your internet connection and try again.")}}const $t={crewName:"A1",crewNumber:"F1",fireName:"C2",fireNumber:"F2",date1:"F4",date2:"H4",nameStartRow:6,nameCol:"B",classCol:"D",on1Col:"E",off1Col:"F",on2Col:"G",off2Col:"H",totalHoursRow:30,totalHoursCol:"C"};async function Bt(e,t,s,o="/CTR_Template.xlsx",r=$t){try{if(!Array.isArray(e))throw new Error("Data must be an array");const l=await fetch(o);if(!l.ok)throw new Error(`Failed to fetch template: ${l.statusText}`);const u=await l.arrayBuffer(),D=_e(u,{type:"array"}),i=D.Sheets[D.SheetNames[0]];r.crewName&&(i[r.crewName]={t:"s",v:(t==null?void 0:t.crewName)||""}),r.crewNumber&&(i[r.crewNumber]={t:"s",v:(t==null?void 0:t.crewNumber)||""}),r.fireName&&(i[r.fireName]={t:"s",v:(t==null?void 0:t.fireName)||""}),r.fireNumber&&(i[r.fireNumber]={t:"s",v:(t==null?void 0:t.fireNumber)||""}),r.date1&&(i[r.date1]={t:"s",v:(s==null?void 0:s[0])||""}),r.date2&&(i[r.date2]={t:"s",v:(s==null?void 0:s[1])||""});const p=r.nameStartRow||6;e.forEach((v,L)=>{var g,j;if(!v||!v.name&&!v.classification)return;const $=p+L;$>p+19||(r.nameCol&&(i[`${r.nameCol}${$}`]={t:"s",v:v.name||""}),r.classCol&&(i[`${r.classCol}${$}`]={t:"s",v:v.classification||""}),(g=v.days)!=null&&g[0]&&(r.on1Col&&(i[`${r.on1Col}${$}`]={t:"s",v:v.days[0].on||""}),r.off1Col&&(i[`${r.off1Col}${$}`]={t:"s",v:v.days[0].off||""})),(j=v.days)!=null&&j[1]&&(r.on2Col&&(i[`${r.on2Col}${$}`]={t:"s",v:v.days[1].on||""}),r.off2Col&&(i[`${r.off2Col}${$}`]={t:"s",v:v.days[1].off||""})))});const f=kt(e);return r.totalHoursRow&&r.totalHoursCol&&(i[`${r.totalHoursCol}${r.totalHoursRow}`]={t:"n",v:f}),D}catch(l){throw console.error("Error filling Excel template:",l),l}}function kt(e){if(!Array.isArray(e))return 0;let t=0;for(const s of e)if(!(!s||!s.days||!Array.isArray(s.days)))for(const o of s.days){if(!o)continue;const r=Be(o.on),l=Be(o.off);r!==null&&l!==null&&l>=r&&(t+=l-r)}return Number(t.toFixed(2))}function Be(e){if(!/^\d{4}$/.test(e))return null;const t=parseInt(e.slice(0,2),10),s=parseInt(e.slice(2,4),10);return t>23||s>59?null:t+s/60}class At{constructor(){this.db=null,this.DB_NAME="ctr-database",this.STORE_NAME="ctr_records"}async initDB(){return this.db||(this.db=await Ue(this.DB_NAME,1,{upgrade(t){t.objectStoreNames.contains("ctr_records")||t.createObjectStore("ctr_records")}})),this.db}formatDateRange(t,s){return`${t} to ${s}`}async saveRecord(t,s,o,r){const l=await this.initDB(),u=this.formatDateRange(t,s);console.log("Saving date range:",u),await l.put(this.STORE_NAME,{dateRange:u,data:o,crewInfo:r},u)}async getRecord(t){const s=await this.initDB();return console.log("Getting record for date range:",t),s.get(this.STORE_NAME,t)}async getAllDateRanges(){const s=await(await this.initDB()).getAllKeys(this.STORE_NAME);return console.log("All date ranges:",s),s}async deleteRecord(t){await(await this.initDB()).delete(this.STORE_NAME,t)}}const ne=new At;function Ot(e){const{message:t,type:s,onClose:o,duration:r=3e3}=e;return fe.useEffect(()=>{const l=setTimeout(()=>{o()},r);return()=>clearTimeout(l)},[r,o]),a.jsxs("div",{className:`notification notification-${s}`,children:[a.jsx("div",{className:"notification-content",children:t}),a.jsx("button",{className:"notification-close",onClick:o,children:"Ã—"})]})}const O={crewInfo:{crewName:"B1",crewNumber:"H1",fireName:"C2",fireNumber:"H2"},dates:{date1:"F4",date2:"H4"},crewMembers:{startRow:6,columns:{name:"B",classification:"D",on1:"E",off1:"F",on2:"G",off2:"H"}}};function H(e,t){var l;if(e[t]&&e[t].v!==void 0)return e[t].v;const s=e["!merges"]||[],o=Pe.decode_cell,r=o(t);for(const u of s)if(r.r>=u.s.r&&r.r<=u.e.r&&r.c>=u.s.c&&r.c<=u.e.c){const D=Pe.encode_cell({r:u.s.r,c:u.s.c});return((l=e[D])==null?void 0:l.v)??""}return""}function _t(e){const t={crewName:H(e,O.crewInfo.crewName)||"",crewNumber:H(e,O.crewInfo.crewNumber)||"",fireName:H(e,O.crewInfo.fireName)||"",fireNumber:H(e,O.crewInfo.fireNumber)||""},s=H(e,O.dates.date1)||"",o=H(e,O.dates.date2)||"",r=[];let l=O.crewMembers.startRow;for(;l<=25;){const u=e[`${O.crewMembers.columns.name}${l}`];if(!(u!=null&&u.v))break;const D={name:H(e,`${O.crewMembers.columns.name}${l}`),classification:H(e,`${O.crewMembers.columns.classification}${l}`),days:[{date:s,on:H(e,`${O.crewMembers.columns.on1}${l}`),off:H(e,`${O.crewMembers.columns.off1}${l}`)},{date:o,on:H(e,`${O.crewMembers.columns.on2}${l}`),off:H(e,`${O.crewMembers.columns.off2}${l}`)}]};r.push(D),l++}return{crewInfo:t,crewMembers:r}}function ke(e){let t=0;return e.forEach(s=>{s.days&&s.days.forEach(o=>{if(!o.on||!o.off)return;const r=Ae(o.on),l=Ae(o.off);if(r===null||l===null)return;let u=(l-r)/60;u<0&&(u+=24),t+=u})}),Number(t.toFixed(2))}function Ae(e){if(/^\d{4}$/.test(e)){const s=parseInt(e.substring(0,2)),o=parseInt(e.substring(2,4));if(s>=0&&s<=23&&o>=0&&o<=59)return s*60+o}const t=e.match(/^(\d{1,2}):(\d{2})$/);if(t){const s=parseInt(t[1]),o=parseInt(t[2]);if(s>=0&&s<=23&&o>=0&&o<=59)return s*60+o}return null}const Lt=({savedDates:e,onDateSelect:t,onClose:s})=>{const[o,r]=h.useState(new Date),[l,u]=h.useState(null),[D,i]=h.useState([]);h.useEffect(()=>{const g=o.getFullYear(),j=o.getMonth(),R=new Date(g,j,1),T=new Date(g,j+1,0),E=R.getDay(),_=35-(T.getDate()+E),Y=[];for(let k=E-1;k>=0;k--)Y.push(new Date(g,j,-k));for(let k=1;k<=T.getDate();k++)Y.push(new Date(g,j,k));for(let k=1;k<=_;k++)Y.push(new Date(g,j+1,k));i(Y)},[o]);const p=()=>{r(new Date(o.getFullYear(),o.getMonth()-1,1))},f=()=>{r(new Date(o.getFullYear(),o.getMonth()+1,1))},v=g=>{u(g);const j=g.toISOString().split("T")[0],R=e.find(T=>{const[M,E]=T.split(" to ");return j>=M&&j<=E});R&&(t(R),s())},L=g=>{const j=g.toISOString().split("T")[0];return e.some(R=>{const[T,M]=R.split(" to ");return j>=T&&j<=M})},$=g=>g.getMonth()===o.getMonth();return a.jsx("div",{className:"date-calendar-modal",children:a.jsxs("div",{className:"date-calendar-content",children:[a.jsxs("div",{className:"date-calendar-header",children:[a.jsx("button",{onClick:p,children:"<"}),a.jsx("h3",{children:o.toLocaleString("default",{month:"long",year:"numeric"})}),a.jsx("button",{onClick:f,children:">"})]}),a.jsxs("div",{className:"date-calendar-grid",children:[a.jsx("div",{className:"date-calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(g=>a.jsx("div",{className:"date-calendar-weekday",children:g},g))}),a.jsx("div",{className:"date-calendar-days",children:D.map((g,j)=>a.jsx("div",{className:`date-calendar-day ${$(g)?"":"other-month"} ${L(g)?"has-entry":""} ${(l==null?void 0:l.toDateString())===g.toDateString()?"selected":""}`,onClick:()=>v(g),children:g.getDate()},j))})]}),a.jsx("button",{className:"date-calendar-close",onClick:s,children:"Close"})]})})};typeof window<"u"&&!Ne.workerSrc&&(Ne.workerSrc=Ne.workerSrc||new URL("pdfjs-dist/build/pdf.worker.min.js",self.location).href);const It={disableAutoFetch:!0,disableStream:!0,disableFontFace:!1,useSystemFonts:!0,standardFontDataUrl:void 0,cMapUrl:void 0,isEvalSupported:!1},Wt=({pdfId:e,onSave:t,className:s,style:o,readOnly:r=!1})=>{const l=h.useRef(null),u=h.useRef(null),D=h.useRef(null),i=h.useRef(null),[p,f]=h.useState(!0),[v,L]=h.useState(null),[$,g]=h.useState(!1),[j,R]=h.useState("#000000"),[T,M]=h.useState(2),E=h.useRef(null);h.useRef(null);const B=h.useCallback(async N=>{if(!(!l.current||!u.current))try{f(!0);const x=await N.getPage(1),C=l.current,S=C.getContext("2d",{alpha:!1,willReadFrequently:!1}),A=u.current,U=A.getContext("2d",{alpha:!0,willReadFrequently:!0});if(!S||!U)return;const F=x.getViewport({scale:1}),V=D.current;if(V){const Q=V.clientWidth,te=V.clientHeight,X=Math.min(Q/F.width,te/F.height);F.scale=X}C.height=F.height,C.width=F.width,A.height=F.height,A.width=F.width,S.fillStyle="white",S.fillRect(0,0,C.width,C.height),U.clearRect(0,0,A.width,A.height),await x.render({canvasContext:S,viewport:F}).promise,f(!1)}catch(x){console.error("Error rendering page:",x),L("Failed to render page. Please try again."),f(!1)}},[]),_=N=>{if(!u.current)return;const x=u.current.getBoundingClientRect(),C=u.current.width/x.width,S=u.current.height/x.height;E.current={x:(N.clientX-x.left)*C,y:(N.clientY-x.top)*S},g(!0)},Y=N=>{if(!$||!u.current||!E.current)return;const x=u.current,C=x.getContext("2d");if(!C)return;const S=x.getBoundingClientRect(),A=x.width/S.width,U=x.height/S.height,F={x:(N.clientX-S.left)*A,y:(N.clientY-S.top)*U};C.beginPath(),C.strokeStyle=j,C.lineWidth=T,C.lineCap="round",C.moveTo(E.current.x,E.current.y),C.lineTo(F.x,F.y),C.stroke(),E.current=F},k=()=>{g(!1),E.current=null},ae=()=>{const N=u.current;if(!N)return;const x=N.getContext("2d");x&&x.clearRect(0,0,N.width,N.height)},q=async()=>{if(!(!l.current||!u.current||!t||!i.current))try{const N=u.current,x=await new Promise(J=>{N.toBlob(ge=>{J(ge)},"image/png")}),C=await i.current.getData(),S=await Oe.load(C),U=S.getPages()[0],F=new Uint8Array(await x.arrayBuffer()),V=await S.embedPng(F),{width:Q,height:te}=U.getSize();U.drawImage(V,{x:0,y:0,width:Q,height:te,opacity:1});const X=await S.save(),re=new Blob([X],{type:"application/pdf"});t(re)}catch(N){console.error("Error saving PDF:",N),L("Failed to save PDF with annotations.")}};return h.useEffect(()=>{let N=!0,x=null;return(async()=>{if(e)try{f(!0),L(null);const S=await Tt(e);if(!S||!N)return;const A=await S.pdf.arrayBuffer();if(!N)return;const F=await ut({data:A,...It}).promise;if(!N){F.destroy();return}i.current&&i.current.destroy(),x=F,i.current=F,await B(F)}catch(S){console.error("Error loading PDF:",S),N&&(L("Failed to load PDF. Please try again."),f(!1))}})(),()=>{N=!1,x&&x.destroy(),i.current&&(i.current.destroy(),i.current=null)}},[e,B]),a.jsxs("div",{className:`enhanced-pdf-viewer ${s||""}`,style:o,children:[!r&&a.jsxs("div",{className:"toolbar",children:[a.jsx("input",{type:"color",value:j,onChange:N=>R(N.target.value),title:"Drawing Color"}),a.jsx("input",{type:"range",min:"1",max:"10",value:T,onChange:N=>M(Number(N.target.value)),title:"Drawing Width"}),a.jsx("button",{onClick:ae,className:"clear-btn",children:"Clear Drawing"}),a.jsx("button",{onClick:q,className:"save-btn",children:"Save with Signature"})]}),a.jsxs("div",{className:"canvas-container",ref:D,children:[v&&a.jsx("div",{className:"error-message",children:v}),p&&a.jsx("div",{className:"loading",children:"Loading PDF..."}),a.jsx("canvas",{ref:l,className:"pdf-canvas"}),!r&&a.jsx("canvas",{ref:u,className:"draw-canvas",onMouseDown:_,onMouseMove:Y,onMouseUp:k,onMouseLeave:k})]})]})},Ge="ctr-table-data";function ve(e){localStorage.setItem(Ge,JSON.stringify(e))}function Ht(){const e=localStorage.getItem(Ge);if(e)try{return JSON.parse(e)}catch{return Z}return Z}function Ut(){const[e,t]=h.useState(()=>{const c=Ht();return Array.isArray(c)?c:Z}),[s,o]=h.useState(()=>{var c,n;return((n=(c=e[0])==null?void 0:c.days)==null?void 0:n.length)||2}),[r,l]=h.useState(()=>{var n,m;const c=(m=(n=e[0])==null?void 0:n.days)==null?void 0:m.map(d=>d.date);return Array.isArray(c)&&c.length===2?c:["",""]}),[u,D]=h.useState(!1),[i,p]=h.useState({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),[f,v]=h.useState(null),[L,$]=h.useState(0),[g,j]=h.useState([]),[R,T]=h.useState(""),[M,E]=h.useState(!1),[B,_]=h.useState({message:"",type:"info",show:!1}),[Y,k]=h.useState({data:e,crewInfo:i,days:r}),[ae,q]=h.useState(-1),N=ke(e),[x,C]=h.useState(0),[S,A]=h.useState({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),[U,F]=h.useState(!1),[V,Q]=h.useState(null),[te,X]=h.useState(!1),[re,J]=h.useState(null),[ge,we]=h.useState({}),[Xe,se]=h.useState(!1);h.useEffect(()=>{oe()},[]),h.useEffect(()=>{k({data:[...e],crewInfo:{...i},days:[...r]})},[]),h.useEffect(()=>{C(N)},[]),h.useEffect(()=>{const c=!!(i.crewName&&i.crewNumber&&i.fireName&&i.fireNumber),n=!!(r[0]&&r[1]),m=Math.abs(N-x)>.01,d=i.crewName!==S.crewName||i.crewNumber!==S.crewNumber||i.fireName!==S.fireName||i.fireNumber!==S.fireNumber;E(!!((m||d)&&c&&n))},[N,i,r,x,S]);const oe=async()=>{try{const c=await ne.getAllDateRanges();j(c)}catch(c){console.error("Error loading saved dates:",c)}},b=(c,n)=>{_({message:c,type:n,show:!0})},ze=()=>{_(c=>({...c,show:!1}))},Ke=async()=>{if(!r[0]||!r[1]){b("Please select both dates before saving.","warning");return}try{const c=r[0],n=r[1];await ne.saveRecord(c,n,e,i),await oe(),C(N),A({...i}),E(!1),b("Data saved successfully!","success")}catch(c){console.error("Error saving data:",c),b("Failed to save data. Please try again.","error")}},ye=()=>R?g.findIndex(c=>c===R):-1,Je=async()=>{const c=ye();if(c>0){const n=g[c-1];E(!1),await ce(n)}},Ze=async()=>{const c=ye();if(c<g.length-1){const n=g[c+1];E(!1),await ce(n)}},ce=async c=>{if(c==="new"){if(M){b("You have unsaved changes. Please save or discard them before starting a new entry.","warning");return}t(Z),p({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),l(["",""]),T(""),q(-1),E(!1),C(0),A({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),J(null),b("New entry started","info");return}if(M){b("You have unsaved changes. Please save or discard them before loading another date range.","warning");return}try{const n=await ne.getRecord(c);if(n){t(n.data),p(n.crewInfo);const[m,d]=n.dateRange.split(" to ");l([m,d]),T(c),q(g.indexOf(c)),E(!1);const y=ke(n.data);C(y),A({...n.crewInfo}),J(ge[c]||null),b("Data loaded successfully","success")}}catch(n){console.error("Error loading selected date range:",n),b("Failed to load data. Please try again.","error")}};h.useEffect(()=>{ve(e)},[e]);const ie=(c,n,m)=>{const d=Date.now();d-L<300&&v({row:c,field:n,dayIdx:m}),$(d)},le=(c,n,m)=>{v({row:c,field:n,dayIdx:m})},qe=c=>{if(!c)return!0;if(c.length>4)return!1;const n=c.split("").map(Number);return!(n[0]>2||n[0]===2&&n[1]>3||n[2]>5)},ue=(c,n,m,d)=>{var I,z;const{value:y}=c.target;if((m==="on"||m==="off")&&(!/^\d*$/.test(y)||!qe(y)))return;const w=[...e];if(w[n]||(w[n]={name:"",classification:"",days:r.map(P=>({date:P,on:"",off:""}))}),w[n].days||(w[n].days=r.map(P=>({date:P,on:"",off:""}))),d!==void 0){if(w[n].days[d]||(w[n].days[d]={date:r[d]||"",on:"",off:""}),w[n].days[d][m]=y,n===1)for(let P=2;P<w.length;P++)(I=w[P])!=null&&I.name&&(w[P].days[d]||(w[P].days[d]={date:r[d]||"",on:"",off:""}),w[P].days[d][m]=y)}else if(w[n][m]=y,m==="name"&&y){const P=w.findIndex(W=>{var G,ee;return((G=W==null?void 0:W.classification)==null?void 0:G.toUpperCase().includes("FFT1"))||((ee=W==null?void 0:W.classification)==null?void 0:ee.toUpperCase().includes("FFT2"))});if(P!==-1&&n>P&&((z=w[P])!=null&&z.days)){const W=w[P].days;w[n].days=W.map(G=>({...G}))}}t(w),E(!0)},de=()=>{setTimeout(()=>{v(null)},200)},Qe=c=>{const n=e.filter((m,d)=>d!==c);t(n)},et=(c,n)=>{const m=c.target.value;l(d=>d.map((y,w)=>w===n?m:y)),t(d=>d.map(y=>({...y,days:y.days.map((w,I)=>I===n?{...w,date:m}:w)}))),E(!0)},tt=()=>{t(Z),ve(Z),D(!1),b("Restored to original default data!","info")},rt=()=>{ve(e),D(!1),b("Current table saved as default!","success")},nt=async()=>{try{if(!r[0]||!r[1]){b("Please select both dates before generating Excel.","warning");return}if(!i.crewNumber||!i.fireName||!i.fireNumber){b("Please fill in all crew and fire information before generating Excel.","warning");return}if(!e.some(m=>m.name&&m.classification&&m.days.some(d=>d.on||d.off))){b("Please enter at least one crew member's information before generating Excel.","warning");return}b("Generating Excel...","info");const n=await Bt(e,i,r,"/CTR_Template.xlsx");dt(n,Se({date:r[0],crewNumber:i.crewNumber,fireName:i.fireName,fireNumber:i.fireNumber,type:"Excel"})),b("Excel file generated successfully!","success")}catch(c){console.error("Error generating Excel:",c);let n="Failed to generate Excel file. ";c instanceof Error&&(c.message.includes("network")||c.message.includes("fetch")?n+="Please check your internet connection and try again.":c.message.includes("template")?n+="The Excel template could not be loaded. Please try refreshing the page.":n+="An unexpected error occurred. Please try again."),b(n,"error")}},at=async()=>{try{const c=await Mt(e,i,{downloadImmediately:!1,returnBlob:!1}),n=`${r[0]} to ${r[1]}`;we(m=>({...m,[n]:c.pdfId})),J(c.pdfId),b("PDF generated successfully. Click below to view and sign.","success")}catch(c){console.error("Error exporting PDF:",c),b("Failed to export PDF. Please try again.","error")}},st=c=>{var d;const n=(d=c.target.files)==null?void 0:d[0];if(!n)return;const m=new FileReader;m.onload=y=>{var w;try{const I=(w=y.target)==null?void 0:w.result,z=_e(I,{type:"binary"}),P=z.SheetNames[0],W=z.Sheets[P],{crewInfo:G,crewMembers:ee}=_t(W);if(p(G),t(ee),ee.length>0){const Fe=ee[0].days.map(it=>it.date);l(Fe),o(Fe.length)}D(!0),b("Excel file imported successfully","success")}catch(I){console.error("Error importing Excel file:",I),b("Error importing Excel file. Please check the file format.","error")}},m.readAsBinaryString(n)},ot=async()=>{if(!r[0]||!r[1]){b("Please set both dates before copying to next days.","warning");return}if(!e.some(n=>n.name&&n.classification)){b("Please enter crew information before copying to next days.","warning");return}try{b("Copying data to next 20 days...","info");const n=new Date(r[0]),m=new Date(r[1]),d=Math.ceil((m.getTime()-n.getTime())/(1e3*60*60*24));for(let y=0;y<20;y++){const w=new Date(m);w.setDate(w.getDate()+1+y*(d+1));const I=new Date(w);I.setDate(I.getDate()+d);const z=w.toISOString().split("T")[0],P=I.toISOString().split("T")[0],W=e.map(G=>({name:G.name,classification:G.classification,days:[{date:z,on:"",off:""},{date:P,on:"",off:""}]}));await ne.saveRecord(z,P,W,i)}await oe(),q(ye()),b("Successfully copied crew information to next 20 days!","success")}catch(n){console.error("Error copying data to next days:",n),b("Failed to copy data to next days. Please try again.","error")}},ct=async()=>{if(!R){b("Please select a date range to remove.","warning");return}if(M){b("Please save or discard your changes before removing an entry.","warning");return}try{await ne.deleteRecord(R),we(c=>{const n={...c};return delete n[R],n}),await oe(),T(""),q(-1),t(Z),p({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),l(["",""]),J(null),b("Entry removed successfully","success")}catch(c){console.error("Error removing entry:",c),b("Failed to remove entry. Please try again.","error")}};return a.jsxs("div",{className:"ctr-container",children:[B.show&&a.jsx(Ot,{message:B.message,type:B.type,onClose:ze}),a.jsx("h2",{className:"ctr-title",children:"Crew Time Report Table"}),a.jsxs("div",{className:"ctr-date-controls",children:[a.jsxs("div",{className:"ctr-date-selector",children:[a.jsxs("select",{value:R,onChange:c=>ce(c.target.value),className:"ctr-select",children:[a.jsx("option",{value:"new",children:"New Entry"}),a.jsx("option",{value:"",children:"Select a saved date range..."}),g.map(c=>{const[n,m]=c.split(" to ");return a.jsxs("option",{value:c,children:[n," to ",m]},c)})]}),a.jsx("button",{className:"ctr-btn calendar-btn",onClick:()=>F(!0),title:"Open Calendar View",children:"ðŸ“…"})]}),a.jsxs("div",{className:"ctr-navigation-buttons",children:[a.jsx("button",{className:"ctr-btn nav-btn",onClick:Je,disabled:ae<=0,children:"â† Previous"}),a.jsx("button",{className:"ctr-btn nav-btn",onClick:Ze,disabled:ae>=g.length-1,children:"Next â†’"})]}),a.jsx("button",{className:"ctr-btn copy-btn",onClick:ot,disabled:!r[1],children:"Copy to Next 20 Days"}),a.jsx("button",{className:"ctr-btn save-btn",onClick:Ke,disabled:!M||!r[0]||!r[1],children:M?"Save Changes":"Saved"})]}),a.jsxs("div",{className:"ctr-crew-info-form",children:[a.jsx("input",{className:"ctr-input",placeholder:"Crew Name",value:i.crewName,onChange:c=>p({...i,crewName:c.target.value})}),a.jsx("input",{className:"ctr-input",placeholder:"Crew Number",value:i.crewNumber,onChange:c=>p({...i,crewNumber:c.target.value})}),a.jsx("input",{className:"ctr-input",placeholder:"Fire Name",value:i.fireName,onChange:c=>p({...i,fireName:c.target.value})}),a.jsx("input",{className:"ctr-input",placeholder:"Fire Number",value:i.fireNumber,onChange:c=>p({...i,fireNumber:c.target.value})})]}),a.jsxs("div",{className:"ctr-actions",children:[a.jsx("input",{type:"file",accept:".xlsx",onChange:st}),a.jsx("button",{className:"ctr-btn",onClick:nt,children:"Export Excel"}),a.jsx("button",{className:"ctr-btn",onClick:at,children:"Save to PDF"}),u&&a.jsx("button",{className:"ctr-btn",onClick:rt,style:{background:"#388e3c"},children:"Save as Default"}),a.jsx("button",{className:"ctr-btn",onClick:tt,style:{background:"#888"},children:"Reset to Default"}),a.jsx("button",{className:"ctr-btn",onClick:ct,disabled:!R,style:{background:"#d32f2f"},children:"Remove Entry"})]}),a.jsx("div",{style:{overflowX:"auto",maxWidth:"100%"},children:a.jsxs("table",{className:"ctr-table",children:[a.jsxs("thead",{children:[a.jsxs("tr",{children:[a.jsx("th",{className:"ctr-th name",rowSpan:2,children:"NAME"}),a.jsx("th",{className:"ctr-th class",rowSpan:2,children:"CLASS"}),r.map((c,n)=>a.jsxs("th",{className:"ctr-th date",colSpan:2,style:{textAlign:"center"},children:["DATE",a.jsx("br",{}),a.jsx("input",{className:"ctr-input ctr-date",type:"date",value:c,onChange:m=>et(m,n),style:{fontWeight:"bold",fontSize:14,textAlign:"center",background:"transparent",border:"none",borderBottom:"1.5px solid #d32f2f"}})]},n)),a.jsx("th",{className:"ctr-th",rowSpan:2})]}),a.jsx("tr",{children:r.map((c,n)=>a.jsxs(fe.Fragment,{children:[a.jsx("th",{className:"ctr-th",children:"ON"}),a.jsx("th",{className:"ctr-th",children:"OFF"})]},n))})]}),a.jsx("tbody",{children:Array.from({length:20}).map((c,n)=>{const m=e[n]||{name:"",classification:"",days:r.map(d=>({date:d,on:"",off:""}))};return a.jsxs("tr",{className:"ctr-tr",children:[a.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===n&&(f==null?void 0:f.field)==="name"?a.jsx("input",{className:"ctr-input",value:m.name||"",onChange:d=>ue(d,n,"name"),onBlur:de,autoFocus:!0}):a.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>le(n,"name"),onTouchStart:()=>ie(n,"name"),children:m.name||""})}),a.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===n&&(f==null?void 0:f.field)==="classification"?a.jsx("input",{className:"ctr-input",value:m.classification,onChange:d=>ue(d,n,"classification"),onBlur:de,autoFocus:!0}):a.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>le(n,"classification"),onTouchStart:()=>ie(n,"classification"),children:m.classification})}),m.days.map((d,y)=>a.jsxs(fe.Fragment,{children:[a.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===n&&(f==null?void 0:f.field)==="on"&&(f==null?void 0:f.dayIdx)===y?a.jsx("input",{className:"ctr-input ctr-on",value:d.on,onChange:w=>ue(w,n,"on",y),onBlur:de,autoFocus:!0,placeholder:"HHMM",maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}):a.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>le(n,"on",y),onTouchStart:()=>ie(n,"on",y),children:d.on})}),a.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===n&&(f==null?void 0:f.field)==="off"&&(f==null?void 0:f.dayIdx)===y?a.jsx("input",{className:"ctr-input ctr-off",value:d.off,onChange:w=>ue(w,n,"off",y),onBlur:de,autoFocus:!0,placeholder:"HHMM",maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}):a.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>le(n,"off",y),onTouchStart:()=>ie(n,"off",y),children:d.off})})]},y)),a.jsx("td",{className:"ctr-td",children:e[n]&&a.jsx("button",{className:"ctr-btn",style:{background:"#d32f2f",padding:"2px 6px"},onClick:()=>Qe(n),children:"Ã—"})})]},n)})})]})}),a.jsxs("div",{className:"ctr-total-hours",children:[a.jsx("div",{className:"ctr-total-label",children:"Total Hours Worked:"}),a.jsx("div",{className:"ctr-total-value",children:N.toFixed(2)})]}),re&&a.jsxs("div",{className:"ctr-pdf-section",children:[a.jsx("h3",{children:"Generated PDF"}),a.jsxs("div",{className:"ctr-pdf-buttons",children:[a.jsx("button",{className:"ctr-btn view-pdf-btn",onClick:()=>{se(!1),X(!0)},children:"View PDF"}),a.jsx("button",{className:"ctr-btn sign-pdf-btn",onClick:()=>{se(!0),X(!0)},children:"Sign PDF"})]})]}),U&&a.jsx(Lt,{savedDates:g,onDateSelect:ce,onClose:()=>F(!1)}),V!==null&&a.jsx("div",{className:"custom-date-picker",children:a.jsx("input",{type:"date",value:r[V],onChange:c=>{const n=c.target.value;l(m=>m.map((d,y)=>y===V?n:d)),t(m=>m.map(d=>({...d,days:d.days.map((y,w)=>w===V?{...y,date:n}:y)}))),E(!0),Q(null)},onBlur:()=>Q(null),autoFocus:!0})}),te&&re&&a.jsx("div",{className:"modal",children:a.jsxs("div",{className:"modal-content pdf-modal",children:[a.jsx("button",{className:"modal-close-btn",onClick:()=>{X(!1),se(!1)},children:"Ã—"}),a.jsx(Wt,{pdfId:re,readOnly:!Xe,onSave:async c=>{try{const n=`${r[0]} to ${r[1]}`,m=await Ye(c,{filename:Se({date:r[0],crewNumber:i.crewNumber,fireName:i.fireName,fireNumber:i.fireNumber,type:"PDF"}),date:r[0],crewNumber:i.crewNumber,fireName:i.fireName,fireNumber:i.fireNumber});we(d=>({...d,[n]:m})),J(m),X(!1),se(!1),b("PDF saved with signature","success")}catch(n){console.error("Error saving signed PDF:",n),b("Failed to save signed PDF","error")}}})]})})]})}function Vt(){return a.jsx(Ut,{})}"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});setInterval(()=>{e.update()},60*60*1e3),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&window.confirm("New version available! Would you like to update? (Reload required)")&&window.location.reload()})}),console.log("SW registered: ",e)}catch(e){console.error("SW registration failed: ",e)}}):console.warn("Service workers are not supported in this browser");xe.createRoot(document.getElementById("root")).render(a.jsx(fe.StrictMode,{children:a.jsx(Vt,{})}));
//# sourceMappingURL=main-a68441a2.js.map
