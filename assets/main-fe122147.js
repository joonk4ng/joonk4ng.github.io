import{r as N,a as et,R as me}from"./vendor-57209f9c.js";import{P as Be,r as Oe,u as Ce,w as tt}from"./utils-a72ad076.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();var Le={exports:{}},he={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nt=N,rt=Symbol.for("react.element"),at=Symbol.for("react.fragment"),st=Object.prototype.hasOwnProperty,ot=nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ct={key:!0,ref:!0,__self:!0,__source:!0};function Ae(e,t,o){var s,n={},c=null,l=null;o!==void 0&&(c=""+o),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(l=t.ref);for(s in t)st.call(t,s)&&!ct.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)n[s]===void 0&&(n[s]=t[s]);return{$$typeof:rt,type:e,key:c,ref:l,props:n,_owner:ot.current}}he.Fragment=at;he.jsx=Ae;he.jsxs=Ae;Le.exports=he;var r=Le.exports,ve={},Fe=et;ve.createRoot=Fe.createRoot,ve.hydrateRoot=Fe.hydrateRoot;const Q=[{name:"John Smith",classification:"FFT1",days:[{date:"2024-06-01",on:"0830",off:"1730"},{date:"2024-06-02",on:"0830",off:"1730"}]},{name:"Jane Doe",classification:"FFT2",days:[{date:"2024-06-01",on:"0830",off:"1730"},{date:"2024-06-02",on:"0830",off:"1730"}]}];function it(e,t,o){var n,c;const s={};return t&&(s["1 CREW NAME"]=t.crewName||"",s["2 CREW NUMER"]=t.crewNumber||"",s["4FIRE NAME"]=t.fireName||"",s["5 FIRE NUMBER"]=t.fireNumber||""),(n=e[0])!=null&&n.days[0]&&(s.DATE=e[0].days[0].date),(c=e[0])!=null&&c.days[1]&&(s.DATE_2=e[0].days[1].date),e.forEach((l,p)=>{var v,f;if(!(l!=null&&l.name)&&!(l!=null&&l.classification))return;const i=p+1;s[`NAME OF EMPLOYEERow${i}`]=l.name||"",s[`ClASS IF CATIONRow${i}`]=l.classification||"",(v=l.days)!=null&&v[0]&&(s[`ONRow${i}`]=l.days[0].on||"",s[`OFFRow${i}`]=l.days[0].off||""),(f=l.days)!=null&&f[1]&&(s[`ONRow${i}_2`]=l.days[1].on||"",s[`OFFRow${i}_2`]=l.days[1].off||"")}),s}function _e(e){const{date:t,crewNumber:o,fireName:s,fireNumber:n,type:c}=e,l=t.includes("-")?t:new Date(t).toISOString().split("T")[0],p=o.replace(/[^a-zA-Z0-9]/g,""),i=s.replace(/[^a-zA-Z0-9]/g,""),v=n.replace(/[^a-zA-Z0-9]/g,""),f=`${l} ${p} ${i} ${v} ${c} CTR`;switch(c){case"PDF":return`${f}.pdf`;case"Excel":return`${f}.xlsx`;case"CSV":return`${f}.csv`;default:return f}}const lt=(e,t)=>t.some(o=>e instanceof o);let Pe,Re;function dt(){return Pe||(Pe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ut(){return Re||(Re=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ie=new WeakMap,xe=new WeakMap,Ue=new WeakMap,ye=new WeakMap,Ee=new WeakMap;function ft(e){const t=new Promise((o,s)=>{const n=()=>{e.removeEventListener("success",c),e.removeEventListener("error",l)},c=()=>{o(X(e.result)),n()},l=()=>{s(e.error),n()};e.addEventListener("success",c),e.addEventListener("error",l)});return t.then(o=>{o instanceof IDBCursor&&Ie.set(o,e)}).catch(()=>{}),Ee.set(t,e),t}function mt(e){if(xe.has(e))return;const t=new Promise((o,s)=>{const n=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",l),e.removeEventListener("abort",l)},c=()=>{o(),n()},l=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",c),e.addEventListener("error",l),e.addEventListener("abort",l)});xe.set(e,t)}let Se={get(e,t,o){if(e instanceof IDBTransaction){if(t==="done")return xe.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ue.get(e);if(t==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return X(e[t])},set(e,t,o){return e[t]=o,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ht(e){Se=e(Se)}function gt(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...o){const s=e.call(be(this),t,...o);return Ue.set(s,t.sort?t.sort():[t]),X(s)}:ut().includes(e)?function(...t){return e.apply(be(this),t),X(Ie.get(this))}:function(...t){return X(e.apply(be(this),t))}}function Nt(e){return typeof e=="function"?gt(e):(e instanceof IDBTransaction&&mt(e),lt(e,dt())?new Proxy(e,Se):e)}function X(e){if(e instanceof IDBRequest)return ft(e);if(ye.has(e))return ye.get(e);const t=Nt(e);return t!==e&&(ye.set(e,t),Ee.set(t,e)),t}const be=e=>Ee.get(e);function He(e,t,{blocked:o,upgrade:s,blocking:n,terminated:c}={}){const l=indexedDB.open(e,t),p=X(l);return s&&l.addEventListener("upgradeneeded",i=>{s(X(l.result),i.oldVersion,i.newVersion,X(l.transaction),i)}),o&&l.addEventListener("blocked",i=>o(i.oldVersion,i.newVersion,i)),p.then(i=>{c&&i.addEventListener("close",()=>c()),n&&i.addEventListener("versionchange",v=>n(v.oldVersion,v.newVersion,v))}).catch(()=>{}),p}const wt=["get","getKey","getAll","getAllKeys","count"],yt=["put","add","delete","clear"],De=new Map;function Te(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(De.get(t))return De.get(t);const o=t.replace(/FromIndex$/,""),s=t!==o,n=yt.includes(o);if(!(o in(s?IDBIndex:IDBObjectStore).prototype)||!(n||wt.includes(o)))return;const c=async function(l,...p){const i=this.transaction(l,n?"readwrite":"readonly");let v=i.store;return s&&(v=v.index(p.shift())),(await Promise.all([v[o](...p),n&&i.done]))[0]};return De.set(t,c),c}ht(e=>({...e,get:(t,o,s)=>Te(t,o)||e.get(t,o,s),has:(t,o)=>!!Te(t,o)||e.has(t,o)}));const bt="ctr-pdf-storage",ce="pdfs",Dt=1;async function ge(){return console.log("Initializing IndexedDB..."),He(bt,Dt,{upgrade(e){console.log("Upgrading database..."),e.objectStoreNames.contains(ce)||(console.log("Creating object store..."),e.createObjectStore(ce,{keyPath:"id"}))}})}async function We(e,t){console.log("Storing PDF in IndexedDB...",t);const o=await ge(),s=`${t.date}_${t.crewNumber}_${t.fireName}_${t.fireNumber}`;try{return await o.put(ce,{id:s,pdf:e,metadata:t,timestamp:new Date().toISOString()}),console.log("PDF stored successfully with ID:",s),s}catch(n){throw console.error("Error storing PDF:",n),n}}async function pt(e){console.log("Retrieving PDF from IndexedDB:",e);const o=await(await ge()).get(ce,e);return console.log("Retrieved PDF:",o?"Found":"Not found"),o}async function vt(){console.log("Listing all PDFs from IndexedDB...");try{const e=await ge();console.log("Database initialized successfully");const t=await e.getAll(ce);return console.log("Found PDFs:",t.length),console.log("PDFs data:",t),t}catch(e){throw console.error("Error in listPDFs:",e),e instanceof Error&&(console.error("Error details:",e.message),console.error("Error stack:",e.stack)),e}}async function xt(e){console.log("Deleting PDF from IndexedDB:",e),await(await ge()).delete(ce,e),console.log("PDF deleted successfully")}async function St(e,t,o="/CTR_Fillable_Edited.pdf"){var s,n,c,l;try{const p=`${o}?t=${Date.now()}`,i=await fetch(p,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!i.ok)throw new Error(`Failed to fetch PDF: ${i.statusText}`);const v=await i.arrayBuffer(),f=await Be.load(v),j=f.getForm(),O=it(e,t);console.log("Available PDF form fields:",j.getFields().map(P=>P.getName())),Object.entries(O).forEach(([P,R])=>{try{console.log(`Attempting to fill field: ${P} with value: ${R}`),j.getTextField(P).setText(R)}catch(B){console.warn(`Field ${P} not found in PDF:`,B)}});const k=await f.save(),w=new Blob([k],{type:"application/pdf"}),E=_e({date:((n=(s=e[0])==null?void 0:s.days[0])==null?void 0:n.date)||new Date().toISOString().split("T")[0],crewNumber:t.crewNumber||"",fireName:t.fireName||"",fireNumber:t.fireNumber||"",type:"PDF"});await We(w,{filename:E,date:((l=(c=e[0])==null?void 0:c.days[0])==null?void 0:l.date)||new Date().toISOString().split("T")[0],crewNumber:t.crewNumber||"",fireName:t.fireName||"",fireNumber:t.fireNumber||""});const x=URL.createObjectURL(w),M=document.createElement("a");M.href=x,M.download=E,M.click(),URL.revokeObjectURL(x)}catch(p){throw console.error("Error filling PDF:",p),p instanceof Error?p:new Error("Failed to generate PDF. Please check your internet connection and try again.")}}const Et={crewName:"A1",crewNumber:"F1",fireName:"C2",fireNumber:"F2",date1:"F4",date2:"H4",nameStartRow:6,nameCol:"B",classCol:"D",on1Col:"E",off1Col:"F",on2Col:"G",off2Col:"H",totalHoursRow:30,totalHoursCol:"C"};async function jt(e,t,o,s="/CTR_Template.xlsx",n=Et){try{if(!Array.isArray(e))throw new Error("Data must be an array");const c=await fetch(s);if(!c.ok)throw new Error(`Failed to fetch template: ${c.statusText}`);const l=await c.arrayBuffer(),p=Oe(l,{type:"array"}),i=p.Sheets[p.SheetNames[0]];n.crewName&&(i[n.crewName]={t:"s",v:(t==null?void 0:t.crewName)||""}),n.crewNumber&&(i[n.crewNumber]={t:"s",v:(t==null?void 0:t.crewNumber)||""}),n.fireName&&(i[n.fireName]={t:"s",v:(t==null?void 0:t.fireName)||""}),n.fireNumber&&(i[n.fireNumber]={t:"s",v:(t==null?void 0:t.fireNumber)||""}),n.date1&&(i[n.date1]={t:"s",v:(o==null?void 0:o[0])||""}),n.date2&&(i[n.date2]={t:"s",v:(o==null?void 0:o[1])||""});const v=n.nameStartRow||6;e.forEach((j,O)=>{var w,E;if(!j||!j.name&&!j.classification)return;const k=v+O;k>v+19||(n.nameCol&&(i[`${n.nameCol}${k}`]={t:"s",v:j.name||""}),n.classCol&&(i[`${n.classCol}${k}`]={t:"s",v:j.classification||""}),(w=j.days)!=null&&w[0]&&(n.on1Col&&(i[`${n.on1Col}${k}`]={t:"s",v:j.days[0].on||""}),n.off1Col&&(i[`${n.off1Col}${k}`]={t:"s",v:j.days[0].off||""})),(E=j.days)!=null&&E[1]&&(n.on2Col&&(i[`${n.on2Col}${k}`]={t:"s",v:j.days[1].on||""}),n.off2Col&&(i[`${n.off2Col}${k}`]={t:"s",v:j.days[1].off||""})))});const f=Ct(e);return n.totalHoursRow&&n.totalHoursCol&&(i[`${n.totalHoursCol}${n.totalHoursRow}`]={t:"n",v:f}),p}catch(c){throw console.error("Error filling Excel template:",c),c}}function Ct(e){if(!Array.isArray(e))return 0;let t=0;for(const o of e)if(!(!o||!o.days||!Array.isArray(o.days)))for(const s of o.days){if(!s)continue;const n=Me(s.on),c=Me(s.off);n!==null&&c!==null&&c>=n&&(t+=c-n)}return Number(t.toFixed(2))}function Me(e){if(!/^\d{4}$/.test(e))return null;const t=parseInt(e.slice(0,2),10),o=parseInt(e.slice(2,4),10);return t>23||o>59?null:t+o/60}class Ft{constructor(){this.db=null,this.DB_NAME="ctr-database",this.STORE_NAME="ctr_records"}async initDB(){return this.db||(this.db=await He(this.DB_NAME,1,{upgrade(t){t.objectStoreNames.contains("ctr_records")||t.createObjectStore("ctr_records")}})),this.db}formatDateRange(t,o){return`${t} to ${o}`}async saveRecord(t,o,s,n){const c=await this.initDB(),l=this.formatDateRange(t,o);console.log("Saving date range:",l),await c.put(this.STORE_NAME,{dateRange:l,data:s,crewInfo:n},l)}async getRecord(t){const o=await this.initDB();return console.log("Getting record for date range:",t),o.get(this.STORE_NAME,t)}async getAllDateRanges(){const o=await(await this.initDB()).getAllKeys(this.STORE_NAME);return console.log("All date ranges:",o),o}async deleteRecord(t){await(await this.initDB()).delete(this.STORE_NAME,t)}}const ue=new Ft;function Pt(e){const{message:t,type:o,onClose:s,duration:n=3e3}=e;return me.useEffect(()=>{const c=setTimeout(()=>{s()},n);return()=>clearTimeout(c)},[n,s]),r.jsxs("div",{className:`notification notification-${o}`,children:[r.jsx("div",{className:"notification-content",children:t}),r.jsx("button",{className:"notification-close",onClick:s,children:"×"})]})}const L={crewInfo:{crewName:"B1",crewNumber:"H1",fireName:"C2",fireNumber:"H2"},dates:{date1:"F4",date2:"H4"},crewMembers:{startRow:6,columns:{name:"B",classification:"D",on1:"E",off1:"F",on2:"G",off2:"H"}}};function U(e,t){var c;if(e[t]&&e[t].v!==void 0)return e[t].v;const o=e["!merges"]||[],s=Ce.decode_cell,n=s(t);for(const l of o)if(n.r>=l.s.r&&n.r<=l.e.r&&n.c>=l.s.c&&n.c<=l.e.c){const p=Ce.encode_cell({r:l.s.r,c:l.s.c});return((c=e[p])==null?void 0:c.v)??""}return""}function Rt(e){const t={crewName:U(e,L.crewInfo.crewName)||"",crewNumber:U(e,L.crewInfo.crewNumber)||"",fireName:U(e,L.crewInfo.fireName)||"",fireNumber:U(e,L.crewInfo.fireNumber)||""},o=U(e,L.dates.date1)||"",s=U(e,L.dates.date2)||"",n=[];let c=L.crewMembers.startRow;for(;c<=25;){const l=e[`${L.crewMembers.columns.name}${c}`];if(!(l!=null&&l.v))break;const p={name:U(e,`${L.crewMembers.columns.name}${c}`),classification:U(e,`${L.crewMembers.columns.classification}${c}`),days:[{date:o,on:U(e,`${L.crewMembers.columns.on1}${c}`),off:U(e,`${L.crewMembers.columns.off1}${c}`)},{date:s,on:U(e,`${L.crewMembers.columns.on2}${c}`),off:U(e,`${L.crewMembers.columns.off2}${c}`)}]};n.push(p),c++}return{crewInfo:t,crewMembers:n}}function ke(e){let t=0;return e.forEach(o=>{o.days&&o.days.forEach(s=>{if(!s.on||!s.off)return;const n=$e(s.on),c=$e(s.off);if(n===null||c===null)return;let l=(c-n)/60;l<0&&(l+=24),t+=l})}),Number(t.toFixed(2))}function $e(e){if(/^\d{4}$/.test(e)){const o=parseInt(e.substring(0,2)),s=parseInt(e.substring(2,4));if(o>=0&&o<=23&&s>=0&&s<=59)return o*60+s}const t=e.match(/^(\d{1,2}):(\d{2})$/);if(t){const o=parseInt(t[1]),s=parseInt(t[2]);if(o>=0&&o<=23&&s>=0&&s<=59)return o*60+s}return null}const Tt=({savedDates:e,onDateSelect:t,onClose:o})=>{const[s,n]=N.useState(new Date),[c,l]=N.useState(null),[p,i]=N.useState([]);N.useEffect(()=>{const w=s.getFullYear(),E=s.getMonth(),x=new Date(w,E,1),M=new Date(w,E+1,0),R=x.getDay(),W=35-(M.getDate()+R),A=[];for(let T=R-1;T>=0;T--)A.push(new Date(w,E,-T));for(let T=1;T<=M.getDate();T++)A.push(new Date(w,E,T));for(let T=1;T<=W;T++)A.push(new Date(w,E+1,T));i(A)},[s]);const v=()=>{n(new Date(s.getFullYear(),s.getMonth()-1,1))},f=()=>{n(new Date(s.getFullYear(),s.getMonth()+1,1))},j=w=>{l(w);const E=w.toISOString().split("T")[0],x=e.find(M=>{const[P,R]=M.split(" to ");return E>=P&&E<=R});x&&(t(x),o())},O=w=>{const E=w.toISOString().split("T")[0];return e.some(x=>{const[M,P]=x.split(" to ");return E>=M&&E<=P})},k=w=>w.getMonth()===s.getMonth();return r.jsx("div",{className:"date-calendar-modal",children:r.jsxs("div",{className:"date-calendar-content",children:[r.jsxs("div",{className:"date-calendar-header",children:[r.jsx("button",{onClick:v,children:"<"}),r.jsx("h3",{children:s.toLocaleString("default",{month:"long",year:"numeric"})}),r.jsx("button",{onClick:f,children:">"})]}),r.jsxs("div",{className:"date-calendar-grid",children:[r.jsx("div",{className:"date-calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(w=>r.jsx("div",{className:"date-calendar-weekday",children:w},w))}),r.jsx("div",{className:"date-calendar-days",children:p.map((w,E)=>r.jsx("div",{className:`date-calendar-day ${k(w)?"":"other-month"} ${O(w)?"has-entry":""} ${(c==null?void 0:c.toDateString())===w.toDateString()?"selected":""}`,onClick:()=>j(w),children:w.getDate()},E))})]}),r.jsx("button",{className:"date-calendar-close",onClick:o,children:"Close"})]})})};function Mt(){const[e,t]=N.useState([]),[o,s]=N.useState(!0),[n,c]=N.useState(null),[l,p]=N.useState(null),[i,v]=N.useState(null),[f,j]=N.useState("timestamp"),[O,k]=N.useState("desc"),[w,E]=N.useState(!1),[x,M]=N.useState(!1),[P,R]=N.useState({width:800,height:1e3}),B=N.useRef(null),W=N.useRef(null),A=N.useRef(null),T=N.useRef(null);N.useEffect(()=>{if(B.current&&x){const u=B.current,g=u.getContext("2d");g&&(g.strokeStyle="black",g.lineWidth=2,g.lineCap="round",W.current=g);const S=()=>{if(T.current){const{width:$,height:H}=T.current.getBoundingClientRect();R({width:$,height:H}),u.width=$,u.height=H,g&&(g.strokeStyle="black",g.lineWidth=2,g.lineCap="round")}};S();const C=new ResizeObserver(S);return T.current&&C.observe(T.current),()=>{C.disconnect()}}},[x]),N.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);const ie=u=>{if(!x)return;E(!0);const g=B.current;if(!g)return;const S=g.getBoundingClientRect(),C=le(u,S);A.current=C;const $=W.current;$&&($.beginPath(),$.moveTo(C.x,C.y))},J=u=>{if(!w||!x)return;const g=B.current;if(!g)return;const S=g.getBoundingClientRect(),C=le(u,S),$=W.current;$&&A.current&&($.beginPath(),$.moveTo(A.current.x,A.current.y),$.lineTo(C.x,C.y),$.stroke()),A.current=C},V=()=>{E(!1),A.current=null},le=(u,g)=>{if("touches"in u){const S=u.touches[0];return{x:S.clientX-g.left,y:S.clientY-g.top}}else return{x:u.clientX-g.left,y:u.clientY-g.top}},G=()=>{const u=W.current,g=B.current;u&&g&&u.clearRect(0,0,g.width,g.height)},Z=async()=>{if(!(!l||!B.current))try{s(!0),c(null);const u=B.current,g=await new Promise(se=>{u.toBlob(we=>{se(we)},"image/png")}),S=await l.pdf.arrayBuffer(),C=await Be.load(S),$=await C.embedPng(await g.arrayBuffer()),H=C.getPages()[0],{width:ne,height:re}=H.getSize();H.drawImage($,{x:0,y:0,width:ne,height:re,opacity:.8});const Ne=await C.save(),ae=new Blob([Ne],{type:"application/pdf"});await We(ae,l.metadata),await z(),G(),M(!1)}catch(u){console.error("Error saving drawing:",u),c("Failed to save drawing. Please try again.")}finally{s(!1)}},z=async()=>{try{console.log("Refreshing PDFs..."),s(!0),c(null);const u=await vt();if(console.log("Refreshed PDFs:",u),t(u),l){const g=u.find(S=>S.id===l.id);g&&p(g)}}catch(u){console.error("Error refreshing PDFs:",u),c("Failed to refresh PDFs. Please try again.")}finally{s(!1)}};N.useEffect(()=>{console.log("StoredPDFs component mounted"),z()},[]);const q=u=>{u===f?k(O==="asc"?"desc":"asc"):(j(u),k("desc"))},fe=[...e].sort((u,g)=>{let S=0;switch(f){case"date":S=u.metadata.date.localeCompare(g.metadata.date);break;case"crewNumber":S=u.metadata.crewNumber.localeCompare(g.metadata.crewNumber);break;case"fireName":S=u.metadata.fireName.localeCompare(g.metadata.fireName);break;case"timestamp":S=new Date(u.timestamp).getTime()-new Date(g.timestamp).getTime();break}return O==="asc"?S:-S}),ee=async u=>{try{console.log("Opening PDF:",u.metadata.filename),i&&URL.revokeObjectURL(i);const g=URL.createObjectURL(u.pdf);v(g),p(u),c(null),x&&G()}catch(g){console.error("Error opening PDF:",g),c("Failed to open PDF. Please try again.")}},de=()=>{i&&(URL.revokeObjectURL(i),v(null)),p(null)},te=async u=>{try{console.log("Downloading PDF:",u);const g=await pt(u);if(g){const S=URL.createObjectURL(g.pdf),C=document.createElement("a");C.href=S,C.download=g.metadata.filename,C.click(),URL.revokeObjectURL(S)}else console.error("PDF not found:",u),c("PDF not found. It may have been deleted.")}catch(g){console.error("Error downloading PDF:",g),c("Failed to download PDF. Please try again.")}},b=async u=>{try{console.log("Deleting PDF:",u),await xt(u),(l==null?void 0:l.id)===u&&de(),await z()}catch(g){console.error("Error deleting PDF:",g),c("Failed to delete PDF. Please try again.")}};return o?r.jsx("div",{className:"stored-pdfs",children:"Loading stored PDFs..."}):n?r.jsxs("div",{className:"stored-pdfs",children:[r.jsx("div",{className:"error-message",children:n}),r.jsx("button",{onClick:z,children:"Retry"})]}):r.jsxs("div",{className:"stored-pdfs",children:[r.jsxs("div",{className:"stored-pdfs-header",children:[r.jsx("h3",{children:"Stored PDFs"}),r.jsx("button",{onClick:z,className:"refresh-btn",children:"Refresh"})]}),r.jsxs("div",{className:"stored-pdfs-container",children:[r.jsx("div",{className:"pdf-list-panel",children:e.length===0?r.jsx("p",{children:'No PDFs stored yet. Generate a PDF using the "Export to PDF" button above.'}):r.jsxs("div",{className:"pdf-list",children:[r.jsxs("div",{className:"pdf-list-header",children:[r.jsxs("button",{className:`sort-btn ${f==="date"?"active":""}`,onClick:()=>q("date"),children:["Date ",f==="date"&&(O==="asc"?"↑":"↓")]}),r.jsxs("button",{className:`sort-btn ${f==="crewNumber"?"active":""}`,onClick:()=>q("crewNumber"),children:["Crew ",f==="crewNumber"&&(O==="asc"?"↑":"↓")]}),r.jsxs("button",{className:`sort-btn ${f==="fireName"?"active":""}`,onClick:()=>q("fireName"),children:["Fire ",f==="fireName"&&(O==="asc"?"↑":"↓")]}),r.jsxs("button",{className:`sort-btn ${f==="timestamp"?"active":""}`,onClick:()=>q("timestamp"),children:["Stored ",f==="timestamp"&&(O==="asc"?"↑":"↓")]})]}),fe.map(u=>r.jsxs("div",{className:`pdf-item ${(l==null?void 0:l.id)===u.id?"selected":""}`,children:[r.jsxs("div",{className:"pdf-info",children:[r.jsx("strong",{children:u.metadata.filename}),r.jsxs("div",{children:["Date: ",u.metadata.date]}),r.jsxs("div",{children:["Crew: ",u.metadata.crewNumber]}),r.jsxs("div",{children:["Fire: ",u.metadata.fireName," (",u.metadata.fireNumber,")"]}),r.jsxs("div",{children:["Stored: ",new Date(u.timestamp).toLocaleString()]})]}),r.jsxs("div",{className:"pdf-actions",children:[r.jsx("button",{onClick:()=>ee(u),className:"open-btn",children:(l==null?void 0:l.id)===u.id?"Viewing":"View"}),r.jsx("button",{onClick:()=>te(u.id),className:"download-btn",children:"Download"}),r.jsx("button",{onClick:()=>b(u.id),className:"delete-btn",children:"Delete"})]})]},u.id))]})}),l&&i&&r.jsxs("div",{className:"pdf-viewer-panel",children:[r.jsxs("div",{className:"pdf-viewer-header",children:[r.jsx("div",{className:"pdf-viewer-title",children:r.jsx("h4",{children:l.metadata.filename})}),r.jsxs("div",{className:"pdf-viewer-actions",children:[r.jsx("button",{onClick:()=>M(!x),className:`draw-btn ${x?"active":""}`,children:x?"Cancel Drawing":"Draw"}),x&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:G,className:"clear-btn",children:"Clear"}),r.jsx("button",{onClick:Z,className:"save-btn",children:"Save"})]}),r.jsx("button",{onClick:de,className:"close-btn",children:"Close"})]})]}),r.jsxs("div",{className:"pdf-viewer-content",ref:T,children:[r.jsx("iframe",{src:i,title:l.metadata.filename,width:"100%",height:"100%",style:{border:"none",display:x?"none":"block"}}),x&&r.jsx("canvas",{ref:B,width:P.width,height:P.height,onMouseDown:ie,onMouseMove:J,onMouseUp:V,onMouseLeave:V,onTouchStart:ie,onTouchMove:J,onTouchEnd:V,className:"drawing-canvas"})]})]})]})]})}const Ve="ctr-table-data";function pe(e){localStorage.setItem(Ve,JSON.stringify(e))}function kt(){const e=localStorage.getItem(Ve);if(e)try{return JSON.parse(e)}catch{return Q}return Q}function $t(){const[e,t]=N.useState(()=>{const d=kt();return Array.isArray(d)?d:Q}),[o,s]=N.useState(()=>{var d,a;return((a=(d=e[0])==null?void 0:d.days)==null?void 0:a.length)||2}),[n,c]=N.useState(()=>{var a,m;const d=(m=(a=e[0])==null?void 0:a.days)==null?void 0:m.map(h=>h.date);return Array.isArray(d)&&d.length===2?d:["",""]}),[l,p]=N.useState(!1),[i,v]=N.useState({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),[f,j]=N.useState(null),[O,k]=N.useState(0),[w,E]=N.useState([]),[x,M]=N.useState(""),[P,R]=N.useState(!1),[B,W]=N.useState({message:"",type:"info",show:!1}),[A,T]=N.useState({data:e,crewInfo:i,days:n}),[ie,J]=N.useState(-1),V=ke(e),[le,G]=N.useState(0),[Z,z]=N.useState({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),[q,fe]=N.useState(!1),[ee,de]=N.useState(null);N.useEffect(()=>{te()},[]),N.useEffect(()=>{T({data:[...e],crewInfo:{...i},days:[...n]})},[]),N.useEffect(()=>{G(V)},[]),N.useEffect(()=>{const d=!!(i.crewName&&i.crewNumber&&i.fireName&&i.fireNumber),a=!!(n[0]&&n[1]),m=Math.abs(V-le)>.01,h=i.crewName!==Z.crewName||i.crewNumber!==Z.crewNumber||i.fireName!==Z.fireName||i.fireNumber!==Z.fireNumber;R(!!((m||h)&&d&&a))},[V,i,n,le,Z]);const te=async()=>{try{const d=await ue.getAllDateRanges();E(d)}catch(d){console.error("Error loading saved dates:",d)}},b=(d,a)=>{W({message:d,type:a,show:!0})},u=()=>{W(d=>({...d,show:!1}))},g=async()=>{if(!n[0]||!n[1]){b("Please select both dates before saving.","warning");return}try{const d=n[0],a=n[1];await ue.saveRecord(d,a,e,i),await te(),G(V),z({...i}),R(!1),b("Data saved successfully!","success")}catch(d){console.error("Error saving data:",d),b("Failed to save data. Please try again.","error")}},S=()=>x?w.findIndex(d=>d===x):-1,C=async()=>{const d=S();if(d>0){const a=w[d-1];R(!1),await H(a)}},$=async()=>{const d=S();if(d<w.length-1){const a=w[d+1];R(!1),await H(a)}},H=async d=>{if(d==="new"){if(P){b("You have unsaved changes. Please save or discard them before starting a new entry.","warning");return}t(Q),v({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),c(["",""]),M(""),J(-1),R(!1),G(0),z({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),b("New entry started","info");return}if(P){b("You have unsaved changes. Please save or discard them before loading another date range.","warning");return}try{const a=await ue.getRecord(d);if(a){t(a.data),v(a.crewInfo);const[m,h]=a.dateRange.split(" to ");c([m,h]),M(d),J(w.indexOf(d)),R(!1);const D=ke(a.data);G(D),z({...a.crewInfo}),b("Data loaded successfully","success")}}catch(a){console.error("Error loading selected date range:",a),b("Failed to load data. Please try again.","error")}};N.useEffect(()=>{pe(e)},[e]);const ne=(d,a,m)=>{const h=Date.now();h-O<300&&j({row:d,field:a,dayIdx:m}),k(h)},re=(d,a,m)=>{j({row:d,field:a,dayIdx:m})},Ne=d=>{if(!d)return!0;if(d.length>4)return!1;const a=d.split("").map(Number);return!(a[0]>2||a[0]===2&&a[1]>3||a[2]>5)},ae=(d,a,m,h)=>{var _,K;const{value:D}=d.target;if((m==="on"||m==="off")&&(!/^\d*$/.test(D)||!Ne(D)))return;const y=[...e];if(y[a]||(y[a]={name:"",classification:"",days:n.map(F=>({date:F,on:"",off:""}))}),y[a].days||(y[a].days=n.map(F=>({date:F,on:"",off:""}))),h!==void 0){if(y[a].days[h]||(y[a].days[h]={date:n[h]||"",on:"",off:""}),y[a].days[h][m]=D,a===1)for(let F=2;F<y.length;F++)(_=y[F])!=null&&_.name&&(y[F].days[h]||(y[F].days[h]={date:n[h]||"",on:"",off:""}),y[F].days[h][m]=D)}else if(y[a][m]=D,m==="name"&&D){const F=y.findIndex(I=>{var Y,oe;return((Y=I==null?void 0:I.classification)==null?void 0:Y.toUpperCase().includes("FFT1"))||((oe=I==null?void 0:I.classification)==null?void 0:oe.toUpperCase().includes("FFT2"))});if(F!==-1&&a>F&&((K=y[F])!=null&&K.days)){const I=y[F].days;y[a].days=I.map(Y=>({...Y}))}}t(y),R(!0)},se=()=>{setTimeout(()=>{j(null)},200)},we=d=>{const a=e.filter((m,h)=>h!==d);t(a)},ze=(d,a)=>{const m=d.target.value;c(h=>h.map((D,y)=>y===a?m:D)),t(h=>h.map(D=>({...D,days:D.days.map((y,_)=>_===a?{...y,date:m}:y)}))),R(!0)},Ye=()=>{t(Q),pe(Q),p(!1),b("Restored to original default data!","info")},Ge=()=>{pe(e),p(!1),b("Current table saved as default!","success")},Ke=async()=>{try{if(!n[0]||!n[1]){b("Please select both dates before generating Excel.","warning");return}if(!i.crewNumber||!i.fireName||!i.fireNumber){b("Please fill in all crew and fire information before generating Excel.","warning");return}if(!e.some(m=>m.name&&m.classification&&m.days.some(h=>h.on||h.off))){b("Please enter at least one crew member's information before generating Excel.","warning");return}b("Generating Excel...","info");const a=await jt(e,i,n,"/CTR_Template.xlsx");tt(a,_e({date:n[0],crewNumber:i.crewNumber,fireName:i.fireName,fireNumber:i.fireNumber,type:"Excel"})),b("Excel file generated successfully!","success")}catch(d){console.error("Error generating Excel:",d);let a="Failed to generate Excel file. ";d instanceof Error&&(d.message.includes("network")||d.message.includes("fetch")?a+="Please check your internet connection and try again.":d.message.includes("template")?a+="The Excel template could not be loaded. Please try refreshing the page.":a+="An unexpected error occurred. Please try again."),b(a,"error")}},Xe=async()=>{try{if(!n[0]||!n[1]){b("Please select both dates before generating PDF.","warning");return}if(!i.crewNumber||!i.fireName||!i.fireNumber){b("Please fill in all crew and fire information before generating PDF.","warning");return}if(!e.some(a=>a.name&&a.classification&&a.days.some(m=>m.on||m.off))){b("Please enter at least one crew member's information before generating PDF.","warning");return}b("Generating PDF...","info");try{await St(e,i,void 0),b("PDF generated successfully!","success")}catch(a){console.error("Error generating PDF:",a);let m="Failed to generate PDF. ";a instanceof Error&&(a.message.includes("network")||a.message.includes("fetch")?m+="Please check your internet connection and try again.":a.message.includes("cache")?m+="The PDF template could not be loaded. Please try refreshing the page.":m+="An unexpected error occurred. Please try again."),b(m,"error")}}catch(d){console.error("Error in PDF generation process:",d),b("An unexpected error occurred while preparing the PDF.","error")}},Je=d=>{var h;const a=(h=d.target.files)==null?void 0:h[0];if(!a)return;const m=new FileReader;m.onload=D=>{var y;try{const _=(y=D.target)==null?void 0:y.result,K=Oe(_,{type:"binary"}),F=K.SheetNames[0],I=K.Sheets[F],{crewInfo:Y,crewMembers:oe}=Rt(I);if(v(Y),t(oe),oe.length>0){const je=oe[0].days.map(qe=>qe.date);c(je),s(je.length)}p(!0),b("Excel file imported successfully","success")}catch(_){console.error("Error importing Excel file:",_),b("Error importing Excel file. Please check the file format.","error")}},m.readAsBinaryString(a)},Ze=async()=>{if(!n[0]||!n[1]){b("Please set both dates before copying to next days.","warning");return}if(!e.some(a=>a.name&&a.classification)){b("Please enter crew information before copying to next days.","warning");return}try{b("Copying data to next 20 days...","info");const a=new Date(n[0]),m=new Date(n[1]),h=Math.ceil((m.getTime()-a.getTime())/(1e3*60*60*24));for(let D=0;D<20;D++){const y=new Date(m);y.setDate(y.getDate()+1+D*(h+1));const _=new Date(y);_.setDate(_.getDate()+h);const K=y.toISOString().split("T")[0],F=_.toISOString().split("T")[0],I=e.map(Y=>({name:Y.name,classification:Y.classification,days:[{date:K,on:"",off:""},{date:F,on:"",off:""}]}));await ue.saveRecord(K,F,I,i)}await te(),J(S()),b("Successfully copied crew information to next 20 days!","success")}catch(a){console.error("Error copying data to next days:",a),b("Failed to copy data to next days. Please try again.","error")}},Qe=async()=>{if(!x){b("Please select a date range to remove.","warning");return}if(P){b("Please save or discard your changes before removing an entry.","warning");return}try{await ue.deleteRecord(x),await te(),M(""),J(-1),t(Q),v({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),c(["",""]),b("Entry removed successfully","success")}catch(d){console.error("Error removing entry:",d),b("Failed to remove entry. Please try again.","error")}};return r.jsxs("div",{className:"ctr-container",children:[B.show&&r.jsx(Pt,{message:B.message,type:B.type,onClose:u}),r.jsx("h2",{className:"ctr-title",children:"Crew Time Report Table"}),r.jsxs("div",{className:"ctr-date-controls",children:[r.jsxs("div",{className:"ctr-date-selector",children:[r.jsxs("select",{value:x,onChange:d=>H(d.target.value),className:"ctr-select",children:[r.jsx("option",{value:"new",children:"New Entry"}),r.jsx("option",{value:"",children:"Select a saved date range..."}),w.map(d=>{const[a,m]=d.split(" to ");return r.jsxs("option",{value:d,children:[a," to ",m]},d)})]}),r.jsx("button",{className:"ctr-btn calendar-btn",onClick:()=>fe(!0),title:"Open Calendar View",children:"📅"})]}),r.jsxs("div",{className:"ctr-navigation-buttons",children:[r.jsx("button",{className:"ctr-btn nav-btn",onClick:C,disabled:ie<=0,children:"← Previous"}),r.jsx("button",{className:"ctr-btn nav-btn",onClick:$,disabled:ie>=w.length-1,children:"Next →"})]}),r.jsx("button",{className:"ctr-btn copy-btn",onClick:Ze,disabled:!n[1],children:"Copy to Next 20 Days"}),r.jsx("button",{className:"ctr-btn save-btn",onClick:g,disabled:!P||!n[0]||!n[1],children:P?"Save Changes":"Saved"})]}),r.jsxs("div",{className:"ctr-crew-info-form",children:[r.jsx("input",{className:"ctr-input",placeholder:"Crew Name",value:i.crewName,onChange:d=>v({...i,crewName:d.target.value})}),r.jsx("input",{className:"ctr-input",placeholder:"Crew Number",value:i.crewNumber,onChange:d=>v({...i,crewNumber:d.target.value})}),r.jsx("input",{className:"ctr-input",placeholder:"Fire Name",value:i.fireName,onChange:d=>v({...i,fireName:d.target.value})}),r.jsx("input",{className:"ctr-input",placeholder:"Fire Number",value:i.fireNumber,onChange:d=>v({...i,fireNumber:d.target.value})})]}),r.jsxs("div",{className:"ctr-actions",children:[r.jsx("input",{type:"file",accept:".xlsx",onChange:Je}),r.jsx("button",{className:"ctr-btn",onClick:Ke,children:"Export Excel"}),r.jsx("button",{className:"ctr-btn",onClick:Xe,children:"Export to PDF"}),l&&r.jsx("button",{className:"ctr-btn",onClick:Ge,style:{background:"#388e3c"},children:"Save as Default"}),r.jsx("button",{className:"ctr-btn",onClick:Ye,style:{background:"#888"},children:"Reset to Default"}),r.jsx("button",{className:"ctr-btn",onClick:Qe,disabled:!x,style:{background:"#d32f2f"},children:"Remove Entry"})]}),r.jsx("div",{style:{overflowX:"auto",maxWidth:"100%"},children:r.jsxs("table",{className:"ctr-table",children:[r.jsxs("thead",{children:[r.jsxs("tr",{children:[r.jsx("th",{className:"ctr-th name",rowSpan:2,children:"NAME"}),r.jsx("th",{className:"ctr-th class",rowSpan:2,children:"CLASS"}),n.map((d,a)=>r.jsxs("th",{className:"ctr-th date",colSpan:2,style:{textAlign:"center"},children:["DATE",r.jsx("br",{}),r.jsx("input",{className:"ctr-input ctr-date",type:"date",value:d,onChange:m=>ze(m,a),style:{fontWeight:"bold",fontSize:14,textAlign:"center",background:"transparent",border:"none",borderBottom:"1.5px solid #d32f2f"}})]},a)),r.jsx("th",{className:"ctr-th",rowSpan:2})]}),r.jsx("tr",{children:n.map((d,a)=>r.jsxs(me.Fragment,{children:[r.jsx("th",{className:"ctr-th",children:"ON"}),r.jsx("th",{className:"ctr-th",children:"OFF"})]},a))})]}),r.jsx("tbody",{children:Array.from({length:20}).map((d,a)=>{const m=e[a]||{name:"",classification:"",days:n.map(h=>({date:h,on:"",off:""}))};return r.jsxs("tr",{className:"ctr-tr",children:[r.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===a&&(f==null?void 0:f.field)==="name"?r.jsx("input",{className:"ctr-input",value:m.name||"",onChange:h=>ae(h,a,"name"),onBlur:se,autoFocus:!0}):r.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>re(a,"name"),onTouchStart:()=>ne(a,"name"),children:m.name||""})}),r.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===a&&(f==null?void 0:f.field)==="classification"?r.jsx("input",{className:"ctr-input",value:m.classification,onChange:h=>ae(h,a,"classification"),onBlur:se,autoFocus:!0}):r.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>re(a,"classification"),onTouchStart:()=>ne(a,"classification"),children:m.classification})}),m.days.map((h,D)=>r.jsxs(me.Fragment,{children:[r.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===a&&(f==null?void 0:f.field)==="on"&&(f==null?void 0:f.dayIdx)===D?r.jsx("input",{className:"ctr-input ctr-on",value:h.on,onChange:y=>ae(y,a,"on",D),onBlur:se,autoFocus:!0,placeholder:"HHMM",maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}):r.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>re(a,"on",D),onTouchStart:()=>ne(a,"on",D),children:h.on})}),r.jsx("td",{className:"ctr-td",children:(f==null?void 0:f.row)===a&&(f==null?void 0:f.field)==="off"&&(f==null?void 0:f.dayIdx)===D?r.jsx("input",{className:"ctr-input ctr-off",value:h.off,onChange:y=>ae(y,a,"off",D),onBlur:se,autoFocus:!0,placeholder:"HHMM",maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}):r.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>re(a,"off",D),onTouchStart:()=>ne(a,"off",D),children:h.off})})]},D)),r.jsx("td",{className:"ctr-td",children:e[a]&&r.jsx("button",{className:"ctr-btn",style:{background:"#d32f2f",padding:"2px 6px"},onClick:()=>we(a),children:"×"})})]},a)})})]})}),r.jsxs("div",{className:"ctr-total-hours",children:[r.jsx("div",{className:"ctr-total-label",children:"Total Hours Worked:"}),r.jsx("div",{className:"ctr-total-value",children:V.toFixed(2)})]}),q&&r.jsx(Tt,{savedDates:w,onDateSelect:H,onClose:()=>fe(!1)}),ee!==null&&r.jsx("div",{className:"custom-date-picker",children:r.jsx("input",{type:"date",value:n[ee],onChange:d=>{const a=d.target.value;c(m=>m.map((h,D)=>D===ee?a:h)),t(m=>m.map(h=>({...h,days:h.days.map((D,y)=>y===ee?{...D,date:a}:D)}))),R(!0),de(null)},onBlur:()=>de(null),autoFocus:!0})}),r.jsx(Mt,{})]})}function Bt(){return r.jsx($t,{})}"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{const e=await navigator.serviceWorker.getRegistration();if(e)e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&console.log("New service worker installed, will activate on next load")})});else{const t=await navigator.serviceWorker.register("./sw.js",{type:"module",scope:"./"});console.log("SW registered: ",t)}}catch(e){console.error("SW registration failed: ",e)}}):console.warn("Service workers are not supported in this browser");ve.createRoot(document.getElementById("root")).render(r.jsx(me.StrictMode,{children:r.jsx(Bt,{})}));
//# sourceMappingURL=main-fe122147.js.map
