import{r as w,a as ze,R as te}from"./vendor-57209f9c.js";import{P as Xe,r as Ce,u as be,w as Ze}from"./utils-a72ad076.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();var je={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qe=w,qe=Symbol.for("react.element"),et=Symbol.for("react.fragment"),tt=Object.prototype.hasOwnProperty,rt=Qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nt={key:!0,ref:!0,__self:!0,__source:!0};function Fe(e,t,a){var s,r={},c=null,f=null;a!==void 0&&(c=""+a),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(f=t.ref);for(s in t)tt.call(t,s)&&!nt.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:qe,type:e,key:c,ref:f,props:r,_owner:rt.current}}re.Fragment=et;re.jsx=Fe;re.jsxs=Fe;je.exports=re;var i=je.exports,le={},we=ze;le.createRoot=we.createRoot,le.hydrateRoot=we.hydrateRoot;const _=[{name:"John Smith",classification:"FFT1",days:[{date:"2024-06-01",on:"0830",off:"1730"},{date:"2024-06-02",on:"0830",off:"1730"}]},{name:"Jane Doe",classification:"FFT2",days:[{date:"2024-06-01",on:"0830",off:"1730"},{date:"2024-06-02",on:"0830",off:"1730"}]}];function at(e,t,a){var r,c;const s={};return t&&(s["1 CREW NAME"]=t.crewName||"",s["2 CREW NUMER"]=t.crewNumber||"",s["4FIRE NAME"]=t.fireName||"",s["5 FIRE NUMBER"]=t.fireNumber||""),(r=e[0])!=null&&r.days[0]&&(s.DATE=e[0].days[0].date),(c=e[0])!=null&&c.days[1]&&(s.DATE_2=e[0].days[1].date),e.forEach((f,D)=>{var b,m;if(!(f!=null&&f.name)&&!(f!=null&&f.classification))return;const l=D+1;s[`NAME OF EMPLOYEERow${l}`]=f.name||"",s[`ClASS IF CATIONRow${l}`]=f.classification||"",(b=f.days)!=null&&b[0]&&(s[`ONRow${l}`]=f.days[0].on||"",s[`OFFRow${l}`]=f.days[0].off||""),(m=f.days)!=null&&m[1]&&(s[`ONRow${l}_2`]=f.days[1].on||"",s[`OFFRow${l}_2`]=f.days[1].off||"")}),s}function Te(e){const{date:t,crewNumber:a,fireName:s,fireNumber:r,type:c}=e,f=t.includes("-")?t:new Date(t).toISOString().split("T")[0],D=a.replace(/[^a-zA-Z0-9]/g,""),l=s.replace(/[^a-zA-Z0-9]/g,""),b=r.replace(/[^a-zA-Z0-9]/g,""),m=`${f} ${D} ${l} ${b} ${c} CTR`;switch(c){case"PDF":return`${m}.pdf`;case"Excel":return`${m}.xlsx`;case"CSV":return`${m}.csv`;default:return m}}async function st(e,t,a="/CTR_Fillable.pdf"){var s,r;try{const c=await fetch(a,{cache:"force-cache"});if(!c.ok)throw new Error(`Failed to fetch PDF: ${c.statusText}`);const f=await c.arrayBuffer(),D=await Xe.load(f),l=D.getForm(),b=at(e,t);console.log("Available PDF form fields:",l.getFields().map(h=>h.getName())),Object.entries(b).forEach(([h,p])=>{try{console.log(`Attempting to fill field: ${h} with value: ${p}`),l.getTextField(h).setText(p)}catch(x){console.warn(`Field ${h} not found in PDF:`,x)}});const m=await D.save(),E=new Blob([m],{type:"application/pdf"}),B=URL.createObjectURL(E),S=document.createElement("a");S.href=B,S.download=Te({date:((r=(s=e[0])==null?void 0:s.days[0])==null?void 0:r.date)||new Date().toISOString().split("T")[0],crewNumber:t.crewNumber||"",fireName:t.fireName||"",fireNumber:t.fireNumber||"",type:"PDF"}),S.click(),URL.revokeObjectURL(B)}catch(c){throw console.error("Error filling PDF:",c),c instanceof Error?c:new Error("Failed to generate PDF. Please check your internet connection and try again.")}}const ot={crewName:"A1",crewNumber:"F1",fireName:"C2",fireNumber:"F2",date1:"F4",date2:"H4",nameStartRow:6,nameCol:"B",classCol:"D",on1Col:"E",off1Col:"F",on2Col:"G",off2Col:"H",totalHoursRow:30,totalHoursCol:"C"};async function ct(e,t,a,s="/CTR_Template.xlsx",r=ot){try{if(!Array.isArray(e))throw new Error("Data must be an array");const c=await fetch(s);if(!c.ok)throw new Error(`Failed to fetch template: ${c.statusText}`);const f=await c.arrayBuffer(),D=Ce(f,{type:"array"}),l=D.Sheets[D.SheetNames[0]];r.crewName&&(l[r.crewName]={t:"s",v:(t==null?void 0:t.crewName)||""}),r.crewNumber&&(l[r.crewNumber]={t:"s",v:(t==null?void 0:t.crewNumber)||""}),r.fireName&&(l[r.fireName]={t:"s",v:(t==null?void 0:t.fireName)||""}),r.fireNumber&&(l[r.fireNumber]={t:"s",v:(t==null?void 0:t.fireNumber)||""}),r.date1&&(l[r.date1]={t:"s",v:(a==null?void 0:a[0])||""}),r.date2&&(l[r.date2]={t:"s",v:(a==null?void 0:a[1])||""});const b=r.nameStartRow||6;e.forEach((E,B)=>{var h,p;if(!E||!E.name&&!E.classification)return;const S=b+B;S>b+19||(r.nameCol&&(l[`${r.nameCol}${S}`]={t:"s",v:E.name||""}),r.classCol&&(l[`${r.classCol}${S}`]={t:"s",v:E.classification||""}),(h=E.days)!=null&&h[0]&&(r.on1Col&&(l[`${r.on1Col}${S}`]={t:"s",v:E.days[0].on||""}),r.off1Col&&(l[`${r.off1Col}${S}`]={t:"s",v:E.days[0].off||""})),(p=E.days)!=null&&p[1]&&(r.on2Col&&(l[`${r.on2Col}${S}`]={t:"s",v:E.days[1].on||""}),r.off2Col&&(l[`${r.off2Col}${S}`]={t:"s",v:E.days[1].off||""})))});const m=it(e);return r.totalHoursRow&&r.totalHoursCol&&(l[`${r.totalHoursCol}${r.totalHoursRow}`]={t:"n",v:m}),D}catch(c){throw console.error("Error filling Excel template:",c),c}}function it(e){if(!Array.isArray(e))return 0;let t=0;for(const a of e)if(!(!a||!a.days||!Array.isArray(a.days)))for(const s of a.days){if(!s)continue;const r=De(s.on),c=De(s.off);r!==null&&c!==null&&c>=r&&(t+=c-r)}return Number(t.toFixed(2))}function De(e){if(!/^\d{4}$/.test(e))return null;const t=parseInt(e.slice(0,2),10),a=parseInt(e.slice(2,4),10);return t>23||a>59?null:t+a/60}const lt=(e,t)=>t.some(a=>e instanceof a);let pe,ve;function ft(){return pe||(pe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ut(){return ve||(ve=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pe=new WeakMap,fe=new WeakMap,Me=new WeakMap,se=new WeakMap,de=new WeakMap;function dt(e){const t=new Promise((a,s)=>{const r=()=>{e.removeEventListener("success",c),e.removeEventListener("error",f)},c=()=>{a(k(e.result)),r()},f=()=>{s(e.error),r()};e.addEventListener("success",c),e.addEventListener("error",f)});return t.then(a=>{a instanceof IDBCursor&&Pe.set(a,e)}).catch(()=>{}),de.set(t,e),t}function mt(e){if(fe.has(e))return;const t=new Promise((a,s)=>{const r=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",f),e.removeEventListener("abort",f)},c=()=>{a(),r()},f=()=>{s(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",c),e.addEventListener("error",f),e.addEventListener("abort",f)});fe.set(e,t)}let ue={get(e,t,a){if(e instanceof IDBTransaction){if(t==="done")return fe.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Me.get(e);if(t==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return k(e[t])},set(e,t,a){return e[t]=a,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ht(e){ue=e(ue)}function yt(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...a){const s=e.call(oe(this),t,...a);return Me.set(s,t.sort?t.sort():[t]),k(s)}:ut().includes(e)?function(...t){return e.apply(oe(this),t),k(Pe.get(this))}:function(...t){return k(e.apply(oe(this),t))}}function Nt(e){return typeof e=="function"?yt(e):(e instanceof IDBTransaction&&mt(e),lt(e,ft())?new Proxy(e,ue):e)}function k(e){if(e instanceof IDBRequest)return dt(e);if(se.has(e))return se.get(e);const t=Nt(e);return t!==e&&(se.set(e,t),de.set(t,e)),t}const oe=e=>de.get(e);function gt(e,t,{blocked:a,upgrade:s,blocking:r,terminated:c}={}){const f=indexedDB.open(e,t),D=k(f);return s&&f.addEventListener("upgradeneeded",l=>{s(k(f.result),l.oldVersion,l.newVersion,k(f.transaction),l)}),a&&f.addEventListener("blocked",l=>a(l.oldVersion,l.newVersion,l)),D.then(l=>{c&&l.addEventListener("close",()=>c()),r&&l.addEventListener("versionchange",b=>r(b.oldVersion,b.newVersion,b))}).catch(()=>{}),D}const bt=["get","getKey","getAll","getAllKeys","count"],wt=["put","add","delete","clear"],ce=new Map;function Ee(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(ce.get(t))return ce.get(t);const a=t.replace(/FromIndex$/,""),s=t!==a,r=wt.includes(a);if(!(a in(s?IDBIndex:IDBObjectStore).prototype)||!(r||bt.includes(a)))return;const c=async function(f,...D){const l=this.transaction(f,r?"readwrite":"readonly");let b=l.store;return s&&(b=b.index(D.shift())),(await Promise.all([b[a](...D),r&&l.done]))[0]};return ce.set(t,c),c}ht(e=>({...e,get:(t,a,s)=>Ee(t,a)||e.get(t,a,s),has:(t,a)=>!!Ee(t,a)||e.has(t,a)}));class Dt{constructor(){this.db=null,this.DB_NAME="ctr-database",this.STORE_NAME="ctr_records"}async initDB(){return this.db||(this.db=await gt(this.DB_NAME,1,{upgrade(t){t.objectStoreNames.contains("ctr_records")||t.createObjectStore("ctr_records")}})),this.db}formatDateRange(t,a){return`${t} to ${a}`}async saveRecord(t,a,s,r){const c=await this.initDB(),f=this.formatDateRange(t,a);console.log("Saving date range:",f),await c.put(this.STORE_NAME,{dateRange:f,data:s,crewInfo:r},f)}async getRecord(t){const a=await this.initDB();return console.log("Getting record for date range:",t),a.get(this.STORE_NAME,t)}async getAllDateRanges(){const a=await(await this.initDB()).getAllKeys(this.STORE_NAME);return console.log("All date ranges:",a),a}async deleteRecord(t){await(await this.initDB()).delete(this.STORE_NAME,t)}}const U=new Dt;function pt(e){const{message:t,type:a,onClose:s,duration:r=3e3}=e;return te.useEffect(()=>{const c=setTimeout(()=>{s()},r);return()=>clearTimeout(c)},[r,s]),i.jsxs("div",{className:`notification notification-${a}`,children:[i.jsx("div",{className:"notification-content",children:t}),i.jsx("button",{className:"notification-close",onClick:s,children:"×"})]})}const j={crewInfo:{crewName:"B1",crewNumber:"H1",fireName:"C2",fireNumber:"H2"},dates:{date1:"F4",date2:"H4"},crewMembers:{startRow:6,columns:{name:"B",classification:"D",on1:"E",off1:"F",on2:"G",off2:"H"}}};function M(e,t){var c;if(e[t]&&e[t].v!==void 0)return e[t].v;const a=e["!merges"]||[],s=be.decode_cell,r=s(t);for(const f of a)if(r.r>=f.s.r&&r.r<=f.e.r&&r.c>=f.s.c&&r.c<=f.e.c){const D=be.encode_cell({r:f.s.r,c:f.s.c});return((c=e[D])==null?void 0:c.v)??""}return""}function vt(e){const t={crewName:M(e,j.crewInfo.crewName)||"",crewNumber:M(e,j.crewInfo.crewNumber)||"",fireName:M(e,j.crewInfo.fireName)||"",fireNumber:M(e,j.crewInfo.fireNumber)||""},a=M(e,j.dates.date1)||"",s=M(e,j.dates.date2)||"",r=[];let c=j.crewMembers.startRow;for(;c<=25;){const f=e[`${j.crewMembers.columns.name}${c}`];if(!(f!=null&&f.v))break;const D={name:M(e,`${j.crewMembers.columns.name}${c}`),classification:M(e,`${j.crewMembers.columns.classification}${c}`),days:[{date:a,on:M(e,`${j.crewMembers.columns.on1}${c}`),off:M(e,`${j.crewMembers.columns.off1}${c}`)},{date:s,on:M(e,`${j.crewMembers.columns.on2}${c}`),off:M(e,`${j.crewMembers.columns.off2}${c}`)}]};r.push(D),c++}return{crewInfo:t,crewMembers:r}}function Se(e){let t=0;return e.forEach(a=>{a.days&&a.days.forEach(s=>{if(!s.on||!s.off)return;const r=xe(s.on),c=xe(s.off);if(r===null||c===null)return;let f=(c-r)/60;f<0&&(f+=24),t+=f})}),Number(t.toFixed(2))}function xe(e){if(/^\d{4}$/.test(e)){const a=parseInt(e.substring(0,2)),s=parseInt(e.substring(2,4));if(a>=0&&a<=23&&s>=0&&s<=59)return a*60+s}const t=e.match(/^(\d{1,2}):(\d{2})$/);if(t){const a=parseInt(t[1]),s=parseInt(t[2]);if(a>=0&&a<=23&&s>=0&&s<=59)return a*60+s}return null}const Et=({savedDates:e,onDateSelect:t,onClose:a})=>{const[s,r]=w.useState(new Date),[c,f]=w.useState(null),[D,l]=w.useState([]);w.useEffect(()=>{const h=s.getFullYear(),p=s.getMonth(),x=new Date(h,p,1),R=new Date(h,p+1,0),C=x.getDay(),G=35-(R.getDate()+C),H=[];for(let F=C-1;F>=0;F--)H.push(new Date(h,p,-F));for(let F=1;F<=R.getDate();F++)H.push(new Date(h,p,F));for(let F=1;F<=G;F++)H.push(new Date(h,p+1,F));l(H)},[s]);const b=()=>{r(new Date(s.getFullYear(),s.getMonth()-1,1))},m=()=>{r(new Date(s.getFullYear(),s.getMonth()+1,1))},E=h=>{f(h);const p=h.toISOString().split("T")[0],x=e.find(R=>{const[$,C]=R.split(" to ");return p>=$&&p<=C});x&&(t(x),a())},B=h=>{const p=h.toISOString().split("T")[0];return e.some(x=>{const[R,$]=x.split(" to ");return p>=R&&p<=$})},S=h=>h.getMonth()===s.getMonth();return i.jsx("div",{className:"date-calendar-modal",children:i.jsxs("div",{className:"date-calendar-content",children:[i.jsxs("div",{className:"date-calendar-header",children:[i.jsx("button",{onClick:b,children:"<"}),i.jsx("h3",{children:s.toLocaleString("default",{month:"long",year:"numeric"})}),i.jsx("button",{onClick:m,children:">"})]}),i.jsxs("div",{className:"date-calendar-grid",children:[i.jsx("div",{className:"date-calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(h=>i.jsx("div",{className:"date-calendar-weekday",children:h},h))}),i.jsx("div",{className:"date-calendar-days",children:D.map((h,p)=>i.jsx("div",{className:`date-calendar-day ${S(h)?"":"other-month"} ${B(h)?"has-entry":""} ${(c==null?void 0:c.toDateString())===h.toDateString()?"selected":""}`,onClick:()=>E(h),children:h.getDate()},p))})]}),i.jsx("button",{className:"date-calendar-close",onClick:a,children:"Close"})]})})},Re="ctr-table-data";function ie(e){localStorage.setItem(Re,JSON.stringify(e))}function St(){const e=localStorage.getItem(Re);if(e)try{return JSON.parse(e)}catch{return _}return _}function xt(){const[e,t]=w.useState(()=>{const o=St();return Array.isArray(o)?o:_}),[a,s]=w.useState(()=>{var o,n;return((n=(o=e[0])==null?void 0:o.days)==null?void 0:n.length)||2}),[r,c]=w.useState(()=>{var n,u;const o=(u=(n=e[0])==null?void 0:n.days)==null?void 0:u.map(d=>d.date);return Array.isArray(o)&&o.length===2?o:["",""]}),[f,D]=w.useState(!1),[l,b]=w.useState({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),[m,E]=w.useState(null),[B,S]=w.useState(0),[h,p]=w.useState([]),[x,R]=w.useState(""),[$,C]=w.useState(!1),[V,G]=w.useState({message:"",type:"info",show:!1}),[H,F]=w.useState({data:e,crewInfo:l,days:r}),[me,Y]=w.useState(-1),I=Se(e),[he,K]=w.useState(0),[W,ne]=w.useState({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),[$e,ye]=w.useState(!1),[J,Ne]=w.useState(null);w.useEffect(()=>{z()},[]),w.useEffect(()=>{F({data:[...e],crewInfo:{...l},days:[...r]})},[]),w.useEffect(()=>{K(I)},[]),w.useEffect(()=>{const o=!!(l.crewName&&l.crewNumber&&l.fireName&&l.fireNumber),n=!!(r[0]&&r[1]),u=Math.abs(I-he)>.01,d=l.crewName!==W.crewName||l.crewNumber!==W.crewNumber||l.fireName!==W.fireName||l.fireNumber!==W.fireNumber;C(!!((u||d)&&o&&n))},[I,l,r,he,W]);const z=async()=>{try{const o=await U.getAllDateRanges();p(o)}catch(o){console.error("Error loading saved dates:",o)}},g=(o,n)=>{G({message:o,type:n,show:!0})},Ae=()=>{G(o=>({...o,show:!1}))},Be=async()=>{if(!r[0]||!r[1]){g("Please select both dates before saving.","warning");return}try{const o=r[0],n=r[1];await U.saveRecord(o,n,e,l),await z(),K(I),ne({...l}),C(!1),g("Data saved successfully!","success")}catch(o){console.error("Error saving data:",o),g("Failed to save data. Please try again.","error")}},ae=()=>x?h.findIndex(o=>o===x):-1,Oe=async()=>{const o=ae();if(o>0){const n=h[o-1];C(!1),await X(n)}},ke=async()=>{const o=ae();if(o<h.length-1){const n=h[o+1];C(!1),await X(n)}},X=async o=>{if(o==="new"){if($){g("You have unsaved changes. Please save or discard them before starting a new entry.","warning");return}t(_),b({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),c(["",""]),R(""),Y(-1),C(!1),K(0),ne({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),g("New entry started","info");return}if($){g("You have unsaved changes. Please save or discard them before loading another date range.","warning");return}try{const n=await U.getRecord(o);if(n){t(n.data),b(n.crewInfo);const[u,d]=n.dateRange.split(" to ");c([u,d]),R(o),Y(h.indexOf(o)),C(!1);const N=Se(n.data);K(N),ne({...n.crewInfo}),g("Data loaded successfully","success")}}catch(n){console.error("Error loading selected date range:",n),g("Failed to load data. Please try again.","error")}};w.useEffect(()=>{ie(e)},[e]);const Z=(o,n,u)=>{const d=Date.now();d-B<300&&E({row:o,field:n,dayIdx:u}),S(d)},Q=(o,n,u)=>{E({row:o,field:n,dayIdx:u})},_e=o=>{if(!o)return!0;if(o.length>4)return!1;const n=o.split("").map(Number);return!(n[0]>2||n[0]===2&&n[1]>3||n[2]>5)},q=(o,n,u,d)=>{var T,O;const{value:N}=o.target;if((u==="on"||u==="off")&&(!/^\d*$/.test(N)||!_e(N)))return;const y=[...e];if(y[n]||(y[n]={name:"",classification:"",days:r.map(v=>({date:v,on:"",off:""}))}),y[n].days||(y[n].days=r.map(v=>({date:v,on:"",off:""}))),d!==void 0){if(y[n].days[d]||(y[n].days[d]={date:r[d]||"",on:"",off:""}),y[n].days[d][u]=N,n===1)for(let v=2;v<y.length;v++)(T=y[v])!=null&&T.name&&(y[v].days[d]||(y[v].days[d]={date:r[d]||"",on:"",off:""}),y[v].days[d][u]=N)}else if(y[n][u]=N,u==="name"&&N){const v=y.findIndex(P=>{var A,L;return((A=P==null?void 0:P.classification)==null?void 0:A.toUpperCase().includes("FFT1"))||((L=P==null?void 0:P.classification)==null?void 0:L.toUpperCase().includes("FFT2"))});if(v!==-1&&n>v&&((O=y[v])!=null&&O.days)){const P=y[v].days;y[n].days=P.map(A=>({...A}))}}t(y),C(!0)},ee=()=>{setTimeout(()=>{E(null)},200)},Le=o=>{const n=e.filter((u,d)=>d!==o);t(n)},He=(o,n)=>{const u=o.target.value;c(d=>d.map((N,y)=>y===n?u:N)),t(d=>d.map(N=>({...N,days:N.days.map((y,T)=>T===n?{...y,date:u}:y)}))),C(!0)},Ie=()=>{t(_),ie(_),D(!1),g("Restored to original default data!","info")},We=()=>{ie(e),D(!1),g("Current table saved as default!","success")},Ue=async()=>{try{if(!r[0]||!r[1]){g("Please select both dates before generating Excel.","warning");return}if(!l.crewNumber||!l.fireName||!l.fireNumber){g("Please fill in all crew and fire information before generating Excel.","warning");return}if(!e.some(u=>u.name&&u.classification&&u.days.some(d=>d.on||d.off))){g("Please enter at least one crew member's information before generating Excel.","warning");return}g("Generating Excel...","info");const n=await ct(e,l,r,"/CTR_Template.xlsx");Ze(n,Te({date:r[0],crewNumber:l.crewNumber,fireName:l.fireName,fireNumber:l.fireNumber,type:"Excel"})),g("Excel file generated successfully!","success")}catch(o){console.error("Error generating Excel:",o);let n="Failed to generate Excel file. ";o instanceof Error&&(o.message.includes("network")||o.message.includes("fetch")?n+="Please check your internet connection and try again.":o.message.includes("template")?n+="The Excel template could not be loaded. Please try refreshing the page.":n+="An unexpected error occurred. Please try again."),g(n,"error")}},Ve=async()=>{try{if(!r[0]||!r[1]){g("Please select both dates before generating PDF.","warning");return}if(!l.crewNumber||!l.fireName||!l.fireNumber){g("Please fill in all crew and fire information before generating PDF.","warning");return}if(!e.some(n=>n.name&&n.classification&&n.days.some(u=>u.on||u.off))){g("Please enter at least one crew member's information before generating PDF.","warning");return}g("Generating PDF...","info");try{await st(e,l,void 0),g("PDF generated successfully!","success")}catch(n){console.error("Error generating PDF:",n);let u="Failed to generate PDF. ";n instanceof Error&&(n.message.includes("network")||n.message.includes("fetch")?u+="Please check your internet connection and try again.":n.message.includes("cache")?u+="The PDF template could not be loaded. Please try refreshing the page.":u+="An unexpected error occurred. Please try again."),g(u,"error")}}catch(o){console.error("Error in PDF generation process:",o),g("An unexpected error occurred while preparing the PDF.","error")}},Ge=o=>{var d;const n=(d=o.target.files)==null?void 0:d[0];if(!n)return;const u=new FileReader;u.onload=N=>{var y;try{const T=(y=N.target)==null?void 0:y.result,O=Ce(T,{type:"binary"}),v=O.SheetNames[0],P=O.Sheets[v],{crewInfo:A,crewMembers:L}=vt(P);if(b(A),t(L),L.length>0){const ge=L[0].days.map(Je=>Je.date);c(ge),s(ge.length)}D(!0),g("Excel file imported successfully","success")}catch(T){console.error("Error importing Excel file:",T),g("Error importing Excel file. Please check the file format.","error")}},u.readAsBinaryString(n)},Ye=async()=>{if(!r[0]||!r[1]){g("Please set both dates before copying to next days.","warning");return}if(!e.some(n=>n.name&&n.classification)){g("Please enter crew information before copying to next days.","warning");return}try{g("Copying data to next 20 days...","info");const n=new Date(r[0]),u=new Date(r[1]),d=Math.ceil((u.getTime()-n.getTime())/(1e3*60*60*24));for(let N=0;N<20;N++){const y=new Date(u);y.setDate(y.getDate()+1+N*(d+1));const T=new Date(y);T.setDate(T.getDate()+d);const O=y.toISOString().split("T")[0],v=T.toISOString().split("T")[0],P=e.map(A=>({name:A.name,classification:A.classification,days:[{date:O,on:"",off:""},{date:v,on:"",off:""}]}));await U.saveRecord(O,v,P,l)}await z(),Y(ae()),g("Successfully copied crew information to next 20 days!","success")}catch(n){console.error("Error copying data to next days:",n),g("Failed to copy data to next days. Please try again.","error")}},Ke=async()=>{if(!x){g("Please select a date range to remove.","warning");return}if($){g("Please save or discard your changes before removing an entry.","warning");return}try{await U.deleteRecord(x),await z(),R(""),Y(-1),t(_),b({crewName:"",crewNumber:"",fireName:"",fireNumber:""}),c(["",""]),g("Entry removed successfully","success")}catch(o){console.error("Error removing entry:",o),g("Failed to remove entry. Please try again.","error")}};return i.jsxs("div",{className:"ctr-container",children:[V.show&&i.jsx(pt,{message:V.message,type:V.type,onClose:Ae}),i.jsx("h2",{className:"ctr-title",children:"Crew Time Report Table"}),i.jsxs("div",{className:"ctr-date-controls",children:[i.jsxs("div",{className:"ctr-date-selector",children:[i.jsxs("select",{value:x,onChange:o=>X(o.target.value),className:"ctr-select",children:[i.jsx("option",{value:"new",children:"New Entry"}),i.jsx("option",{value:"",children:"Select a saved date range..."}),h.map(o=>{const[n,u]=o.split(" to ");return i.jsxs("option",{value:o,children:[n," to ",u]},o)})]}),i.jsx("button",{className:"ctr-btn calendar-btn",onClick:()=>ye(!0),title:"Open Calendar View",children:"📅"})]}),i.jsxs("div",{className:"ctr-navigation-buttons",children:[i.jsx("button",{className:"ctr-btn nav-btn",onClick:Oe,disabled:me<=0,children:"← Previous"}),i.jsx("button",{className:"ctr-btn nav-btn",onClick:ke,disabled:me>=h.length-1,children:"Next →"})]}),i.jsx("button",{className:"ctr-btn copy-btn",onClick:Ye,disabled:!r[1],children:"Copy to Next 20 Days"}),i.jsx("button",{className:"ctr-btn save-btn",onClick:Be,disabled:!$||!r[0]||!r[1],children:$?"Save Changes":"Saved"})]}),i.jsxs("div",{className:"ctr-crew-info-form",children:[i.jsx("input",{className:"ctr-input",placeholder:"Crew Name",value:l.crewName,onChange:o=>b({...l,crewName:o.target.value})}),i.jsx("input",{className:"ctr-input",placeholder:"Crew Number",value:l.crewNumber,onChange:o=>b({...l,crewNumber:o.target.value})}),i.jsx("input",{className:"ctr-input",placeholder:"Fire Name",value:l.fireName,onChange:o=>b({...l,fireName:o.target.value})}),i.jsx("input",{className:"ctr-input",placeholder:"Fire Number",value:l.fireNumber,onChange:o=>b({...l,fireNumber:o.target.value})})]}),i.jsxs("div",{className:"ctr-actions",children:[i.jsx("input",{type:"file",accept:".xlsx",onChange:Ge}),i.jsx("button",{className:"ctr-btn",onClick:Ue,children:"Export Excel"}),i.jsx("button",{className:"ctr-btn",onClick:Ve,children:"Export to PDF"}),f&&i.jsx("button",{className:"ctr-btn",onClick:We,style:{background:"#388e3c"},children:"Save as Default"}),i.jsx("button",{className:"ctr-btn",onClick:Ie,style:{background:"#888"},children:"Reset to Default"}),i.jsx("button",{className:"ctr-btn",onClick:Ke,disabled:!x,style:{background:"#d32f2f"},children:"Remove Entry"})]}),i.jsx("div",{style:{overflowX:"auto",maxWidth:"100%"},children:i.jsxs("table",{className:"ctr-table",children:[i.jsxs("thead",{children:[i.jsxs("tr",{children:[i.jsx("th",{className:"ctr-th name",rowSpan:2,children:"NAME"}),i.jsx("th",{className:"ctr-th",rowSpan:2,children:"CLASS"}),r.map((o,n)=>i.jsxs("th",{className:"ctr-th date",colSpan:2,style:{textAlign:"center"},children:["DATE",i.jsx("br",{}),i.jsx("input",{className:"ctr-input ctr-date",type:"date",value:o,onChange:u=>He(u,n),style:{fontWeight:"bold",fontSize:14,textAlign:"center",background:"transparent",border:"none",borderBottom:"1.5px solid #d32f2f"}})]},n)),i.jsx("th",{className:"ctr-th",rowSpan:2})]}),i.jsx("tr",{children:r.map((o,n)=>i.jsxs(te.Fragment,{children:[i.jsx("th",{className:"ctr-th",children:"ON"}),i.jsx("th",{className:"ctr-th",children:"OFF"})]},n))})]}),i.jsx("tbody",{children:Array.from({length:20}).map((o,n)=>{const u=e[n]||{name:"",classification:"",days:r.map(d=>({date:d,on:"",off:""}))};return i.jsxs("tr",{className:"ctr-tr",children:[i.jsx("td",{className:"ctr-td",children:(m==null?void 0:m.row)===n&&(m==null?void 0:m.field)==="name"?i.jsx("input",{className:"ctr-input",value:u.name||"",onChange:d=>q(d,n,"name"),onBlur:ee,autoFocus:!0}):i.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>Q(n,"name"),onTouchStart:()=>Z(n,"name"),children:u.name||""})}),i.jsx("td",{className:"ctr-td",children:(m==null?void 0:m.row)===n&&(m==null?void 0:m.field)==="classification"?i.jsx("input",{className:"ctr-input",value:u.classification,onChange:d=>q(d,n,"classification"),onBlur:ee,autoFocus:!0}):i.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>Q(n,"classification"),onTouchStart:()=>Z(n,"classification"),children:u.classification})}),u.days.map((d,N)=>i.jsxs(te.Fragment,{children:[i.jsx("td",{className:"ctr-td",children:(m==null?void 0:m.row)===n&&(m==null?void 0:m.field)==="on"&&(m==null?void 0:m.dayIdx)===N?i.jsx("input",{className:"ctr-input ctr-on",value:d.on,onChange:y=>q(y,n,"on",N),onBlur:ee,autoFocus:!0,placeholder:"HHMM",maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}):i.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>Q(n,"on",N),onTouchStart:()=>Z(n,"on",N),children:d.on})}),i.jsx("td",{className:"ctr-td",children:(m==null?void 0:m.row)===n&&(m==null?void 0:m.field)==="off"&&(m==null?void 0:m.dayIdx)===N?i.jsx("input",{className:"ctr-input ctr-off",value:d.off,onChange:y=>q(y,n,"off",N),onBlur:ee,autoFocus:!0,placeholder:"HHMM",maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}):i.jsx("div",{className:"ctr-cell-content",onDoubleClick:()=>Q(n,"off",N),onTouchStart:()=>Z(n,"off",N),children:d.off})})]},N)),i.jsx("td",{className:"ctr-td",children:e[n]&&i.jsx("button",{className:"ctr-btn",style:{background:"#d32f2f",padding:"2px 6px"},onClick:()=>Le(n),children:"×"})})]},n)})})]})}),i.jsxs("div",{className:"ctr-total-hours",children:[i.jsx("div",{className:"ctr-total-label",children:"Total Hours Worked:"}),i.jsx("div",{className:"ctr-total-value",children:I.toFixed(2)})]}),$e&&i.jsx(Et,{savedDates:h,onDateSelect:X,onClose:()=>ye(!1)}),J!==null&&i.jsx("div",{className:"custom-date-picker",children:i.jsx("input",{type:"date",value:r[J],onChange:o=>{const n=o.target.value;c(u=>u.map((d,N)=>N===J?n:d)),t(u=>u.map(d=>({...d,days:d.days.map((N,y)=>y===J?{...N,date:n}:N)}))),C(!0),Ne(null)},onBlur:()=>Ne(null),autoFocus:!0})})]})}function Ct(){return i.jsx(xt,{})}"serviceWorker"in navigator?window.addEventListener("load",()=>{console.log("Registering service worker..."),navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered successfully:",e)}).catch(e=>{console.error("Service Worker registration failed:",e)})}):console.warn("Service workers are not supported in this browser");le.createRoot(document.getElementById("root")).render(i.jsx(te.StrictMode,{children:i.jsx(Ct,{})}));
//# sourceMappingURL=main-0e5093ce.js.map
